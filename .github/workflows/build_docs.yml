name: Build documentation

on:
  pull_request:
  push:
    branches:
      - nightly
      - main
      - release/*
  workflow_dispatch:

jobs:
  commit:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        ref: gh-pages
    - name: Prepare doc
      run: |
        set -x
        # Let's pretend that this is equivalent of build step
        mkdir -p docs/build/html
        echo "$date" > docs/build/html/index.html

        # Update the main doc
        rm -rf main
        mv docs/build/html main
        ls main
        git add --all main || true
        git ls-files main
        git config user.name "pytorchbot"
        git config user.email "soumith+bot@pytorch.org"
        git commit -m "auto-generating sphinx docs" || true
        git push
