


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>torchaudio.functional.filtering &mdash; Torchaudio 2.4.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/katex-math.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T8XT4PS');</script>
    <!-- End Google Tag Manager -->
  

  
  <script src="../../../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torcharrow">
                  <span class="dropdown-title">torcharrow</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/data">
                  <span class="dropdown-title">TorchData</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchrec">
                  <span class="dropdown-title">TorchRec</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchx/">
                  <span class="dropdown-title">TorchX</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorchâ€™s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/foundation">
                  <span class="dropdown-title">PyTorch Foundation</span>
                  <p>Learn about the PyTorch foundation</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/community-stories">
                  <span class="dropdown-title">Community Stories</span>
                  <p>Learn how our community solves real, everyday machine learning problems with PyTorch.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/events">
                  <span class="dropdown-title">Events</span>
                  <p>Find events, webinars, and podcasts</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href="../../../../versions.html"><span style="font-size:110%">2.4.0 &#x25BC</span></a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Torchaudio Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../supported_features.html">Supported Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../feature_classifications.html">Feature Classifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../logo.html">TorchAudio Logo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installing pre-built binaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build.html">Building from source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build.linux.html">Building on Linux and macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build.windows.html">Building on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build.jetson.html">Building on Jetson</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build.ffmpeg.html">Enabling GPU video decoder/encoder</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/audio_io_tutorial.html">Audio I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/streamreader_basic_tutorial.html">StreamReader Basic Usages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/streamreader_advanced_tutorial.html">StreamReader Advanced Usages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/streamwriter_basic_tutorial.html">StreamWriter Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/streamwriter_advanced.html">StreamWriter Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/nvdec_tutorial.html">Accelerated video decoding with NVDEC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/nvenc_tutorial.html">Accelerated video encoding with NVENC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/effector_tutorial.html">AudioEffector Usages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/audio_resampling_tutorial.html">Audio Resampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/audio_data_augmentation_tutorial.html">Audio Data Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/audio_feature_extractions_tutorial.html">Audio Feature Extractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/audio_feature_augmentation_tutorial.html">Audio Feature Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/ctc_forced_alignment_api_tutorial.html">CTC forced alignment API tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/oscillator_tutorial.html">Oscillator and ADSR envelope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/additive_synthesis_tutorial.html">Additive Synthesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/filter_design_tutorial.html">Filter design tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/subtractive_synthesis_tutorial.html">Subtractive synthesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/audio_datasets_tutorial.html">Audio Datasets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/speech_recognition_pipeline_tutorial.html">Speech Recognition with Wav2Vec2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/asr_inference_with_ctc_decoder_tutorial.html">ASR Inference with CTC Decoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/asr_inference_with_cuda_ctc_decoder_tutorial.html">ASR Inference with CUDA CTC Decoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/online_asr_tutorial.html">Online ASR with Emformer RNN-T</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/device_asr.html">Device ASR with Emformer RNN-T</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/device_avsr.html">Device AV-ASR with Emformer RNN-T</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/forced_alignment_tutorial.html">Forced Alignment with Wav2Vec2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/forced_alignment_for_multilingual_data_tutorial.html">Forced alignment for multilingual data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/tacotron2_pipeline_tutorial.html">Text-to-Speech with Tacotron2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/mvdr_tutorial.html">Speech Enhancement with MVDR Beamforming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/hybrid_demucs_tutorial.html">Music Source Separation with Hybrid Demucs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/squim_tutorial.html">Torchaudio-Squim: Non-intrusive Speech Assessment in TorchAudio</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Training Recipes</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pytorch/audio/tree/main/examples/asr/librispeech_conformer_rnnt">Conformer RNN-T ASR</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pytorch/audio/tree/main/examples/asr/emformer_rnnt">Emformer RNN-T ASR</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pytorch/audio/tree/main/examples/source_separation">Conv-TasNet Source Separation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pytorch/audio/tree/main/examples/hubert">HuBERT Pre-training and Fine-tuning (ASR)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pytorch/audio/tree/main/examples/avsr">Real-time AV-ASR</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../torchaudio.html">torchaudio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io.html">torchaudio.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../functional.html">torchaudio.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../transforms.html">torchaudio.transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../datasets.html">torchaudio.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models.html">torchaudio.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models.decoder.html">torchaudio.models.decoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pipelines.html">torchaudio.pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sox_effects.html">torchaudio.sox_effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../compliance.kaldi.html">torchaudio.compliance.kaldi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kaldi_io.html">torchaudio.kaldi_io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils.html">torchaudio.utils</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../torio.html">torio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../torio.io.html">torio.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../torio.utils.html">torio.utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python Prototype API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../prototype.html">torchaudio.prototype</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../prototype.datasets.html">torchaudio.prototype.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../prototype.functional.html">torchaudio.prototype.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../prototype.models.html">torchaudio.prototype.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../prototype.pipelines.html">torchaudio.prototype.pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../prototype.transforms.html">torchaudio.prototype.transforms</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">C++ Prototype API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../libtorio.html">libtorio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libtorio.stream_reader.html">torio::io::StreamingMediaDecoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libtorio.stream_writer.html">torio::io::StreamingMediaEncoder</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PyTorch Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/docs">PyTorch</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/audio">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/text">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/vision">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/elastic/">TorchElastic</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pytorch.org/xla/">PyTorch on XLA Devices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../../../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="../../index.html">Module code</a> &gt;</li>
        
      <li>torchaudio.functional.filtering &gt;</li>
      
      <li>Old version (stable)</li>
      
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
    
    
          <!-- Google Tag Manager (noscript) -->
          <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8XT4PS"
          height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
          <!-- End Google Tag Manager (noscript) -->
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <h1>Source code for torchaudio.functional.filtering</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">Tensor</span>

<span class="kn">from</span> <span class="nn">torchaudio._extension</span> <span class="kn">import</span> <span class="n">_IS_TORCHAUDIO_EXT_AVAILABLE</span>


<span class="k">def</span> <span class="nf">_dB2Linear</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mf">20.0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_generate_wave_table</span><span class="p">(</span>
    <span class="n">wave_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">table_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="nb">min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="nb">max</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">phase</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A helper function for phaser. Generates a table with given parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        wave_type (str): SINE or TRIANGULAR</span>
<span class="sd">        data_type (str): desired data_type ( `INT` or `FLOAT` )</span>
<span class="sd">        table_size (int): desired table size</span>
<span class="sd">        min (float): desired min value</span>
<span class="sd">        max (float): desired max value</span>
<span class="sd">        phase (float): desired phase</span>
<span class="sd">        device (torch.device): Torch device on which table must be generated</span>
<span class="sd">    Returns:</span>
<span class="sd">        Tensor: A 1D tensor with wave table values</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">phase_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">phase</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">table_size</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">table_size</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="n">point</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">phase_offset</span><span class="p">)</span> <span class="o">%</span> <span class="n">table_size</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">wave_type</span> <span class="o">==</span> <span class="s2">&quot;SINE&quot;</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> <span class="n">table_size</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">wave_type</span> <span class="o">==</span> <span class="s2">&quot;TRIANGLE&quot;</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">table_size</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">point</span><span class="p">,</span> <span class="n">table_size</span><span class="p">,</span> <span class="n">rounding_mode</span><span class="o">=</span><span class="s2">&quot;floor&quot;</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="n">d</span><span class="p">[</span><span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="n">value</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="n">value</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="n">value</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">value</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.5</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="nb">max</span> <span class="o">-</span> <span class="nb">min</span><span class="p">)</span> <span class="o">+</span> <span class="nb">min</span>

    <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;INT&quot;</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="n">d</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span>
        <span class="n">d</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;FLOAT&quot;</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">d</span>


<div class="viewcode-block" id="allpass_biquad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.allpass_biquad.html#torchaudio.functional.allpass_biquad">[docs]</a><span class="k">def</span> <span class="nf">allpass_biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">central_freq</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.707</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Design two-pole all-pass filter.  Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform(torch.Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, e.g. 44100 (Hz)</span>
<span class="sd">        central_freq (float or torch.Tensor): central frequency (in Hz)</span>
<span class="sd">        Q (float or torch.Tensor, optional): https://en.wikipedia.org/wiki/Q_factor (Default: ``0.707``)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">        - https://www.w3.org/2011/audio/audio-eq-cookbook.html#APF</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span>
    <span class="n">central_freq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">central_freq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">w0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">central_freq</span> <span class="o">/</span> <span class="n">sample_rate</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">Q</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span>
    <span class="k">return</span> <span class="n">biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></div>


<div class="viewcode-block" id="band_biquad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.band_biquad.html#torchaudio.functional.band_biquad">[docs]</a><span class="k">def</span> <span class="nf">band_biquad</span><span class="p">(</span>
    <span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">central_freq</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.707</span><span class="p">,</span>
    <span class="n">noise</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Design two-pole band filter.  Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, e.g. 44100 (Hz)</span>
<span class="sd">        central_freq (float or torch.Tensor): central frequency (in Hz)</span>
<span class="sd">        Q (float or torch.Tensor, optional): https://en.wikipedia.org/wiki/Q_factor (Default: ``0.707``).</span>
<span class="sd">        noise (bool, optional) : If ``True``, uses the alternate mode for un-pitched audio (e.g. percussion).</span>
<span class="sd">            If ``False``, uses mode oriented to pitched audio, i.e. voice, singing,</span>
<span class="sd">            or instrumental music (Default: ``False``).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">        - https://www.w3.org/2011/audio/audio-eq-cookbook.html#APF</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span>
    <span class="n">central_freq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">central_freq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">w0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">central_freq</span> <span class="o">/</span> <span class="n">sample_rate</span>
    <span class="n">bw_Hz</span> <span class="o">=</span> <span class="n">central_freq</span> <span class="o">/</span> <span class="n">Q</span>

    <span class="n">a0</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">bw_Hz</span> <span class="o">/</span> <span class="n">sample_rate</span><span class="p">)</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">a2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">noise</span><span class="p">:</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">a1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">))</span> <span class="o">/</span> <span class="n">b0</span>
        <span class="n">b0</span> <span class="o">=</span> <span class="n">mult</span> <span class="o">*</span> <span class="n">b0</span>

    <span class="n">b1</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="n">biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></div>


<div class="viewcode-block" id="bandpass_biquad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.bandpass_biquad.html#torchaudio.functional.bandpass_biquad">[docs]</a><span class="k">def</span> <span class="nf">bandpass_biquad</span><span class="p">(</span>
    <span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">central_freq</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.707</span><span class="p">,</span>
    <span class="n">const_skirt_gain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Design two-pole band-pass filter.  Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, e.g. 44100 (Hz)</span>
<span class="sd">        central_freq (float or torch.Tensor): central frequency (in Hz)</span>
<span class="sd">        Q (float or torch.Tensor, optional): https://en.wikipedia.org/wiki/Q_factor (Default: ``0.707``)</span>
<span class="sd">        const_skirt_gain (bool, optional) : If ``True``, uses a constant skirt gain (peak gain = Q).</span>
<span class="sd">            If ``False``, uses a constant 0dB peak gain. (Default: ``False``)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">        - https://www.w3.org/2011/audio/audio-eq-cookbook.html#APF</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span>
    <span class="n">central_freq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">central_freq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">w0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">central_freq</span> <span class="o">/</span> <span class="n">sample_rate</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">Q</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">const_skirt_gain</span> <span class="k">else</span> <span class="n">alpha</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">temp</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="o">-</span><span class="n">temp</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span>
    <span class="k">return</span> <span class="n">biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></div>


<div class="viewcode-block" id="bandreject_biquad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.bandreject_biquad.html#torchaudio.functional.bandreject_biquad">[docs]</a><span class="k">def</span> <span class="nf">bandreject_biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">central_freq</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.707</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Design two-pole band-reject filter.  Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, e.g. 44100 (Hz)</span>
<span class="sd">        central_freq (float or torch.Tensor): central frequency (in Hz)</span>
<span class="sd">        Q (float or torch.Tensor, optional): https://en.wikipedia.org/wiki/Q_factor (Default: ``0.707``)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">        - https://www.w3.org/2011/audio/audio-eq-cookbook.html#APF</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span>
    <span class="n">central_freq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">central_freq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">w0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">central_freq</span> <span class="o">/</span> <span class="n">sample_rate</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">Q</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span>
    <span class="k">return</span> <span class="n">biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></div>


<div class="viewcode-block" id="bass_biquad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.bass_biquad.html#torchaudio.functional.bass_biquad">[docs]</a><span class="k">def</span> <span class="nf">bass_biquad</span><span class="p">(</span>
    <span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">gain</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">central_freq</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.707</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Design a bass tone-control effect.  Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, e.g. 44100 (Hz)</span>
<span class="sd">        gain (float or torch.Tensor): desired gain at the boost (or attenuation) in dB.</span>
<span class="sd">        central_freq (float or torch.Tensor, optional): central frequency (in Hz). (Default: ``100``)</span>
<span class="sd">        Q (float or torch.Tensor, optional): https://en.wikipedia.org/wiki/Q_factor (Default: ``0.707``).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">        - https://www.w3.org/2011/audio/audio-eq-cookbook.html#APF</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span>
    <span class="n">central_freq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">central_freq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">gain</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">w0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">central_freq</span> <span class="o">/</span> <span class="n">sample_rate</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">Q</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">gain</span> <span class="o">/</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">temp1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha</span>
    <span class="n">temp2</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">temp3</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp2</span> <span class="o">+</span> <span class="n">temp1</span><span class="p">)</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="p">((</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp3</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp2</span> <span class="o">-</span> <span class="n">temp1</span><span class="p">)</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">temp2</span> <span class="o">+</span> <span class="n">temp1</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">temp3</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">temp2</span> <span class="o">-</span> <span class="n">temp1</span>

    <span class="k">return</span> <span class="n">biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">b0</span> <span class="o">/</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b1</span> <span class="o">/</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b2</span> <span class="o">/</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a0</span> <span class="o">/</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span> <span class="o">/</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a0</span><span class="p">)</span></div>


<div class="viewcode-block" id="biquad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.biquad.html#torchaudio.functional.biquad">[docs]</a><span class="k">def</span> <span class="nf">biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">b0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a2</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Perform a biquad filter of input tensor.  Initial conditions set to 0.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        b0 (float or torch.Tensor): numerator coefficient of current input, x[n]</span>
<span class="sd">        b1 (float or torch.Tensor): numerator coefficient of input one time step ago x[n-1]</span>
<span class="sd">        b2 (float or torch.Tensor): numerator coefficient of input two time steps ago x[n-2]</span>
<span class="sd">        a0 (float or torch.Tensor): denominator coefficient of current output y[n], typically 1</span>
<span class="sd">        a1 (float or torch.Tensor): denominator coefficient of current output y[n-1]</span>
<span class="sd">        a2 (float or torch.Tensor): denominator coefficient of current output y[n-2]</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform with dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">       - https://en.wikipedia.org/wiki/Digital_biquad_filter</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">device</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">output_waveform</span> <span class="o">=</span> <span class="n">lfilter</span><span class="p">(</span>
        <span class="n">waveform</span><span class="p">,</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">]),</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">]),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">output_waveform</span></div>


<div class="viewcode-block" id="contrast"><a class="viewcode-back" href="../../../generated/torchaudio.functional.contrast.html#torchaudio.functional.contrast">[docs]</a><span class="k">def</span> <span class="nf">contrast</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">enhancement_amount</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">75.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply contrast effect.  Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Comparable with compression, this effect modifies an audio signal to make it sound louder</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        enhancement_amount (float, optional): controls the amount of the enhancement</span>
<span class="sd">            Allowed range of values for enhancement_amount : 0-100</span>
<span class="sd">            Note that enhancement_amount = 0 still gives a significant contrast enhancement</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">enhancement_amount</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Allowed range of values for enhancement_amount : 0-100&quot;</span><span class="p">)</span>

    <span class="n">contrast</span> <span class="o">=</span> <span class="n">enhancement_amount</span> <span class="o">/</span> <span class="mf">750.0</span>

    <span class="n">temp1</span> <span class="o">=</span> <span class="n">waveform</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">temp2</span> <span class="o">=</span> <span class="n">contrast</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">temp1</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">output_waveform</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">temp1</span> <span class="o">+</span> <span class="n">temp2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_waveform</span></div>


<div class="viewcode-block" id="dcshift"><a class="viewcode-back" href="../../../generated/torchaudio.functional.dcshift.html#torchaudio.functional.dcshift">[docs]</a><span class="k">def</span> <span class="nf">dcshift</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">shift</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">limiter_gain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply a DC shift to the audio. Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: TorchScript</span>

<span class="sd">    This can be useful to remove a DC offset</span>
<span class="sd">    (caused perhaps by a hardware problem in the recording chain) from the audio</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        shift (float): indicates the amount to shift the audio</span>
<span class="sd">            Allowed range of values for shift : -2.0 to +2.0</span>
<span class="sd">        limiter_gain (float of None, optional): It is used only on peaks to prevent clipping</span>
<span class="sd">            It should have a value much less than 1 (e.g. 0.05 or 0.02)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_waveform</span> <span class="o">=</span> <span class="n">waveform</span>
    <span class="n">limiter_threshold</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="n">limiter_gain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">limiter_threshold</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span> <span class="o">-</span> <span class="n">limiter_gain</span><span class="p">)</span>

    <span class="c1"># Note:</span>
    <span class="c1"># the following index-based update breaks auto-grad support</span>
    <span class="k">if</span> <span class="n">limiter_gain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">shift</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">waveform</span> <span class="o">&gt;</span> <span class="n">limiter_threshold</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">waveform</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">limiter_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">limiter_gain</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">limiter_threshold</span><span class="p">)</span>
        <span class="n">output_waveform</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="n">limiter_threshold</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">max</span><span class="o">=</span><span class="n">limiter_threshold</span><span class="p">)</span>
        <span class="n">output_waveform</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">waveform</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">limiter_gain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">shift</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">waveform</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">limiter_threshold</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">waveform</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">limiter_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">limiter_gain</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">limiter_threshold</span><span class="p">)</span>
        <span class="n">output_waveform</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">-</span> <span class="n">limiter_threshold</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="n">limiter_threshold</span><span class="p">)</span>
        <span class="n">output_waveform</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">waveform</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_waveform</span> <span class="o">=</span> <span class="p">(</span><span class="n">waveform</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_waveform</span></div>


<div class="viewcode-block" id="deemph_biquad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.deemph_biquad.html#torchaudio.functional.deemph_biquad">[docs]</a><span class="k">def</span> <span class="nf">deemph_biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply ISO 908 CD de-emphasis (shelving) IIR filter.  Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, Allowed sample rate ``44100`` or ``48000``</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">        - https://www.w3.org/2011/audio/audio-eq-cookbook.html#APF</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">sample_rate</span> <span class="o">==</span> <span class="mi">44100</span><span class="p">:</span>
        <span class="n">central_freq</span> <span class="o">=</span> <span class="mi">5283</span>
        <span class="n">width_slope</span> <span class="o">=</span> <span class="mf">0.4845</span>
        <span class="n">gain</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.477</span>
    <span class="k">elif</span> <span class="n">sample_rate</span> <span class="o">==</span> <span class="mi">48000</span><span class="p">:</span>
        <span class="n">central_freq</span> <span class="o">=</span> <span class="mi">5356</span>
        <span class="n">width_slope</span> <span class="o">=</span> <span class="mf">0.479</span>
        <span class="n">gain</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.62</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sample rate must be 44100 (audio-CD) or 48000 (DAT)&quot;</span><span class="p">)</span>

    <span class="n">w0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">central_freq</span> <span class="o">/</span> <span class="n">sample_rate</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">gain</span> <span class="o">/</span> <span class="mf">40.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">width_slope</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">temp1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha</span>
    <span class="n">temp2</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">temp3</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">temp2</span> <span class="o">+</span> <span class="n">temp1</span><span class="p">)</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="p">((</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">temp3</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">temp2</span> <span class="o">-</span> <span class="n">temp1</span><span class="p">)</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp2</span> <span class="o">+</span> <span class="n">temp1</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp3</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp2</span> <span class="o">-</span> <span class="n">temp1</span>

    <span class="k">return</span> <span class="n">biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_add_noise_shaping</span><span class="p">(</span><span class="n">dithered_waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Noise shaping is calculated by error:</span>
<span class="sd">    error[n] = dithered[n] - original[n]</span>
<span class="sd">    noise_shaped_waveform[n] = dithered[n] + error[n-1]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wf_shape</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wf_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">dithered_shape</span> <span class="o">=</span> <span class="n">dithered_waveform</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="n">dithered_waveform</span> <span class="o">=</span> <span class="n">dithered_waveform</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dithered_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">error</span> <span class="o">=</span> <span class="n">dithered_waveform</span> <span class="o">-</span> <span class="n">waveform</span>

    <span class="c1"># add error[n-1] to dithered_waveform[n], so offset the error by 1 index</span>
    <span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">error</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">error_offset</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">zeros</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
        <span class="n">error</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_offset</span><span class="p">[:</span> <span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="n">noise_shaped</span> <span class="o">=</span> <span class="n">dithered_waveform</span> <span class="o">+</span> <span class="n">error</span>
    <span class="k">return</span> <span class="n">noise_shaped</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dithered_shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">noise_shaped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>


<span class="k">def</span> <span class="nf">_apply_probability_distribution</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">density_function</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;TPDF&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply a probability distribution function on a waveform.</span>

<span class="sd">    Triangular probability density function (TPDF) dither noise has a</span>
<span class="sd">    triangular distribution; values in the center of the range have a higher</span>
<span class="sd">    probability of occurring.</span>

<span class="sd">    Rectangular probability density function (RPDF) dither noise has a</span>
<span class="sd">    uniform distribution; any value in the specified range has the same</span>
<span class="sd">    probability of occurring.</span>

<span class="sd">    Gaussian probability density function (GPDF) has a normal distribution.</span>
<span class="sd">    The relationship of probabilities of results follows a bell-shaped,</span>
<span class="sd">    or Gaussian curve, typical of dither generated by analog sources.</span>
<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): Tensor of audio of dimension (..., time)</span>
<span class="sd">        density_function (str, optional): The density function of a</span>
<span class="sd">           continuous random variable (Default: ``&quot;TPDF&quot;``)</span>
<span class="sd">           Options: Triangular Probability Density Function - `TPDF`</span>
<span class="sd">                    Rectangular Probability Density Function - `RPDF`</span>
<span class="sd">                    Gaussian Probability Density Function - `GPDF`</span>
<span class="sd">    Returns:</span>
<span class="sd">        Tensor: waveform dithered with TPDF</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># pack batch</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">channel_size</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">time_size</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">random_channel</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
                <span class="n">channel_size</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="mi">1</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">channel_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">else</span> <span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">random_time</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
                <span class="n">time_size</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="mi">1</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">time_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">else</span> <span class="mi">0</span>
    <span class="p">)</span>

    <span class="n">number_of_bits</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">up_scaling</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">number_of_bits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="n">signal_scaled</span> <span class="o">=</span> <span class="n">waveform</span> <span class="o">*</span> <span class="n">up_scaling</span>
    <span class="n">down_scaling</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">number_of_bits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">signal_scaled_dis</span> <span class="o">=</span> <span class="n">waveform</span>
    <span class="k">if</span> <span class="n">density_function</span> <span class="o">==</span> <span class="s2">&quot;RPDF&quot;</span><span class="p">:</span>
        <span class="n">RPDF</span> <span class="o">=</span> <span class="n">waveform</span><span class="p">[</span><span class="n">random_channel</span><span class="p">][</span><span class="n">random_time</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span>

        <span class="n">signal_scaled_dis</span> <span class="o">=</span> <span class="n">signal_scaled</span> <span class="o">+</span> <span class="n">RPDF</span>
    <span class="k">elif</span> <span class="n">density_function</span> <span class="o">==</span> <span class="s2">&quot;GPDF&quot;</span><span class="p">:</span>
        <span class="c1"># TODO Replace by distribution code once</span>
        <span class="c1"># https://github.com/pytorch/pytorch/issues/29843 is resolved</span>
        <span class="c1"># gaussian = torch.distributions.normal.Normal(torch.mean(waveform, -1), 1).sample()</span>

        <span class="n">num_rand_variables</span> <span class="o">=</span> <span class="mi">6</span>

        <span class="n">gaussian</span> <span class="o">=</span> <span class="n">waveform</span><span class="p">[</span><span class="n">random_channel</span><span class="p">][</span><span class="n">random_time</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="n">num_rand_variables</span> <span class="o">*</span> <span class="p">[</span><span class="n">time_size</span><span class="p">]:</span>
            <span class="n">rand_chan</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
                    <span class="n">channel_size</span><span class="p">,</span>
                    <span class="p">[</span>
                        <span class="mi">1</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">gaussian</span> <span class="o">+=</span> <span class="n">waveform</span><span class="p">[</span><span class="n">rand_chan</span><span class="p">][</span>
                <span class="nb">int</span><span class="p">(</span>
                    <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
                        <span class="n">ws</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="mi">1</span><span class="p">,</span>
                        <span class="p">],</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="n">signal_scaled_dis</span> <span class="o">=</span> <span class="n">signal_scaled</span> <span class="o">+</span> <span class="n">gaussian</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># dtype needed for https://github.com/pytorch/pytorch/issues/32358</span>
        <span class="n">TPDF</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">bartlett_window</span><span class="p">(</span><span class="n">time_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">signal_scaled</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">signal_scaled</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="n">TPDF</span> <span class="o">=</span> <span class="n">TPDF</span><span class="o">.</span><span class="n">repeat</span><span class="p">((</span><span class="n">channel_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">signal_scaled_dis</span> <span class="o">=</span> <span class="n">signal_scaled</span> <span class="o">+</span> <span class="n">TPDF</span>

    <span class="n">quantised_signal_scaled</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">signal_scaled_dis</span><span class="p">)</span>
    <span class="n">quantised_signal</span> <span class="o">=</span> <span class="n">quantised_signal_scaled</span> <span class="o">/</span> <span class="n">down_scaling</span>

    <span class="c1"># unpack batch</span>
    <span class="k">return</span> <span class="n">quantised_signal</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">quantised_signal</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>


<div class="viewcode-block" id="dither"><a class="viewcode-back" href="../../../generated/torchaudio.functional.dither.html#torchaudio.functional.dither">[docs]</a><span class="k">def</span> <span class="nf">dither</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">density_function</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;TPDF&quot;</span><span class="p">,</span> <span class="n">noise_shaping</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply dither</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: TorchScript</span>

<span class="sd">    Dither increases the perceived dynamic range of audio stored at a</span>
<span class="sd">    particular bit-depth by eliminating nonlinear truncation distortion</span>
<span class="sd">    (i.e. adding minimally perceived noise to mask distortion caused by quantization).</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): Tensor of audio of dimension (..., time)</span>
<span class="sd">        density_function (str, optional):</span>
<span class="sd">            The density function of a continuous random variable. One of</span>
<span class="sd">            ``&quot;TPDF&quot;`` (Triangular Probability Density Function),</span>
<span class="sd">            ``&quot;RPDF&quot;`` (Rectangular Probability Density Function) or</span>
<span class="sd">            ``&quot;GPDF&quot;`` (Gaussian Probability Density Function) (Default: ``&quot;TPDF&quot;``).</span>
<span class="sd">        noise_shaping (bool, optional): a filtering process that shapes the spectral</span>
<span class="sd">            energy of quantisation error (Default: ``False``)</span>

<span class="sd">    Returns:</span>
<span class="sd">       Tensor: waveform dithered</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dithered</span> <span class="o">=</span> <span class="n">_apply_probability_distribution</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">density_function</span><span class="o">=</span><span class="n">density_function</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">noise_shaping</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_add_noise_shaping</span><span class="p">(</span><span class="n">dithered</span><span class="p">,</span> <span class="n">waveform</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dithered</span></div>


<div class="viewcode-block" id="equalizer_biquad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.equalizer_biquad.html#torchaudio.functional.equalizer_biquad">[docs]</a><span class="k">def</span> <span class="nf">equalizer_biquad</span><span class="p">(</span>
    <span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">center_freq</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">gain</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.707</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Design biquad peaking equalizer filter and perform filtering.  Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, e.g. 44100 (Hz)</span>
<span class="sd">        center_freq (float): filter&#39;s central frequency</span>
<span class="sd">        gain (float or torch.Tensor): desired gain at the boost (or attenuation) in dB</span>
<span class="sd">        Q (float or torch.Tensor, optional): https://en.wikipedia.org/wiki/Q_factor (Default: ``0.707``)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span>
    <span class="n">center_freq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">center_freq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">gain</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">w0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">center_freq</span> <span class="o">/</span> <span class="n">sample_rate</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">gain</span> <span class="o">/</span> <span class="mf">40.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">Q</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">A</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">A</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">A</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">A</span>
    <span class="k">return</span> <span class="n">biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></div>


<div class="viewcode-block" id="filtfilt"><a class="viewcode-back" href="../../../generated/torchaudio.functional.filtfilt.html#torchaudio.functional.filtfilt">[docs]</a><span class="k">def</span> <span class="nf">filtfilt</span><span class="p">(</span>
    <span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">a_coeffs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">b_coeffs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">clamp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply an IIR filter forward and backward to a waveform.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Inspired by https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.filtfilt.html</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`.  Must be normalized to -1 to 1.</span>
<span class="sd">        a_coeffs (Tensor): denominator coefficients of difference equation of dimension of either</span>
<span class="sd">                                1D with shape `(num_order + 1)` or 2D with shape `(num_filters, num_order + 1)`.</span>
<span class="sd">                                Lower delay coefficients are first, e.g. ``[a0, a1, a2, ...]``.</span>
<span class="sd">                                Must be same size as b_coeffs (pad with 0&#39;s as necessary).</span>
<span class="sd">        b_coeffs (Tensor): numerator coefficients of difference equation of dimension of either</span>
<span class="sd">                                1D with shape `(num_order + 1)` or 2D with shape `(num_filters, num_order + 1)`.</span>
<span class="sd">                                Lower delay coefficients are first, e.g. ``[b0, b1, b2, ...]``.</span>
<span class="sd">                                Must be same size as a_coeffs (pad with 0&#39;s as necessary).</span>
<span class="sd">        clamp (bool, optional): If ``True``, clamp the output signal to be in the range [-1, 1] (Default: ``True``)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform with dimension of either `(..., num_filters, time)` if ``a_coeffs`` and ``b_coeffs``</span>
<span class="sd">        are 2D Tensors, or `(..., time)` otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">forward_filtered</span> <span class="o">=</span> <span class="n">lfilter</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">a_coeffs</span><span class="p">,</span> <span class="n">b_coeffs</span><span class="p">,</span> <span class="n">clamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batching</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">backward_filtered</span> <span class="o">=</span> <span class="n">lfilter</span><span class="p">(</span>
        <span class="n">forward_filtered</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">a_coeffs</span><span class="p">,</span>
        <span class="n">b_coeffs</span><span class="p">,</span>
        <span class="n">clamp</span><span class="o">=</span><span class="n">clamp</span><span class="p">,</span>
        <span class="n">batching</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">backward_filtered</span></div>


<div class="viewcode-block" id="flanger"><a class="viewcode-back" href="../../../generated/torchaudio.functional.flanger.html#torchaudio.functional.flanger">[docs]</a><span class="k">def</span> <span class="nf">flanger</span><span class="p">(</span>
    <span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">depth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="n">regen</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">71.0</span><span class="p">,</span>
    <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">phase</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">25.0</span><span class="p">,</span>
    <span class="n">modulation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sinusoidal&quot;</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply a flanger effect to the audio. Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., channel, time)` .</span>
<span class="sd">            Max 4 channels allowed</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, e.g. 44100 (Hz)</span>
<span class="sd">        delay (float, optional): desired delay in milliseconds(ms)</span>
<span class="sd">            Allowed range of values are 0 to 30</span>
<span class="sd">        depth (float, optional): desired delay depth in milliseconds(ms)</span>
<span class="sd">            Allowed range of values are 0 to 10</span>
<span class="sd">        regen (float, optional): desired regen(feedback gain) in dB</span>
<span class="sd">            Allowed range of values are -95 to 95</span>
<span class="sd">        width (float, optional):  desired width(delay gain) in dB</span>
<span class="sd">            Allowed range of values are 0 to 100</span>
<span class="sd">        speed (float, optional):  modulation speed in Hz</span>
<span class="sd">            Allowed range of values are 0.1 to 10</span>
<span class="sd">        phase (float, optional):  percentage phase-shift for multi-channel</span>
<span class="sd">            Allowed range of values are 0 to 100</span>
<span class="sd">        modulation (str, optional):  Use either &quot;sinusoidal&quot; or &quot;triangular&quot; modulation. (Default: ``sinusoidal``)</span>
<span class="sd">        interpolation (str, optional): Use either &quot;linear&quot; or &quot;quadratic&quot; for delay-line interpolation.</span>
<span class="sd">            (Default: ``linear``)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., channel, time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>

<span class="sd">        - Scott Lehman, `Effects Explained`_,</span>

<span class="sd">    .. _Effects Explained:</span>
<span class="sd">        https://web.archive.org/web/20051125072557/http://www.harmony-central.com/Effects/effects-explained.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">modulation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;sinusoidal&quot;</span><span class="p">,</span> <span class="s2">&quot;triangular&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only &quot;sinusoidal&quot; or &quot;triangular&quot; modulation allowed&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interpolation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;quadratic&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only &quot;linear&quot; or &quot;quadratic&quot; interpolation allowed&#39;</span><span class="p">)</span>

    <span class="n">actual_shape</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">device</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>

    <span class="k">if</span> <span class="n">actual_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Max 4 channels allowed&quot;</span><span class="p">)</span>

    <span class="c1"># convert to 3D (batch, channels, time)</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">actual_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">actual_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Scaling</span>
    <span class="n">feedback_gain</span> <span class="o">=</span> <span class="n">regen</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="n">delay_gain</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="n">channel_phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="n">delay_min</span> <span class="o">=</span> <span class="n">delay</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">delay_depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">n_channels</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">modulation</span> <span class="o">==</span> <span class="s2">&quot;sinusoidal&quot;</span><span class="p">:</span>
        <span class="n">wave_type</span> <span class="o">=</span> <span class="s2">&quot;SINE&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wave_type</span> <span class="o">=</span> <span class="s2">&quot;TRIANGLE&quot;</span>

    <span class="c1"># Balance output:</span>
    <span class="n">in_gain</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delay_gain</span><span class="p">)</span>
    <span class="n">delay_gain</span> <span class="o">=</span> <span class="n">delay_gain</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delay_gain</span><span class="p">)</span>

    <span class="c1"># Balance feedback loop:</span>
    <span class="n">delay_gain</span> <span class="o">=</span> <span class="n">delay_gain</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">feedback_gain</span><span class="p">))</span>

    <span class="n">delay_buf_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">delay_min</span> <span class="o">+</span> <span class="n">delay_depth</span><span class="p">)</span> <span class="o">*</span> <span class="n">sample_rate</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">delay_buf_length</span> <span class="o">=</span> <span class="n">delay_buf_length</span> <span class="o">+</span> <span class="mi">2</span>

    <span class="n">delay_bufs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_channels</span><span class="p">,</span> <span class="n">delay_buf_length</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">delay_last</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_channels</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">lfo_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample_rate</span> <span class="o">/</span> <span class="n">speed</span><span class="p">)</span>

    <span class="n">table_min</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">delay_min</span> <span class="o">*</span> <span class="n">sample_rate</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">table_max</span> <span class="o">=</span> <span class="n">delay_buf_length</span> <span class="o">-</span> <span class="mf">2.0</span>

    <span class="n">lfo</span> <span class="o">=</span> <span class="n">_generate_wave_table</span><span class="p">(</span>
        <span class="n">wave_type</span><span class="o">=</span><span class="n">wave_type</span><span class="p">,</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;FLOAT&quot;</span><span class="p">,</span>
        <span class="n">table_size</span><span class="o">=</span><span class="n">lfo_length</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">table_min</span><span class="p">),</span>
        <span class="nb">max</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">table_max</span><span class="p">),</span>
        <span class="n">phase</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">output_waveform</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">delay_buf_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lfo_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">channel_idxs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>

        <span class="n">delay_buf_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">delay_buf_pos</span> <span class="o">+</span> <span class="n">delay_buf_length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">delay_buf_length</span>

        <span class="n">cur_channel_phase</span> <span class="o">=</span> <span class="p">(</span><span class="n">channel_idxs</span> <span class="o">*</span> <span class="n">lfo_length</span> <span class="o">*</span> <span class="n">channel_phase</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">delay_tensor</span> <span class="o">=</span> <span class="n">lfo</span><span class="p">[(</span><span class="n">lfo_pos</span> <span class="o">+</span> <span class="n">cur_channel_phase</span><span class="p">)</span> <span class="o">%</span> <span class="n">lfo_length</span><span class="p">]</span>
        <span class="n">frac_delay</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">frac</span><span class="p">(</span><span class="n">delay_tensor</span><span class="p">)</span>
        <span class="n">delay_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">delay_tensor</span><span class="p">)</span>

        <span class="n">int_delay</span> <span class="o">=</span> <span class="n">delay_tensor</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="n">waveform</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>

        <span class="n">delay_bufs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">delay_buf_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">delay_last</span> <span class="o">*</span> <span class="n">feedback_gain</span>

        <span class="n">delayed_0</span> <span class="o">=</span> <span class="n">delay_bufs</span><span class="p">[:,</span> <span class="n">channel_idxs</span><span class="p">,</span> <span class="p">(</span><span class="n">delay_buf_pos</span> <span class="o">+</span> <span class="n">int_delay</span><span class="p">)</span> <span class="o">%</span> <span class="n">delay_buf_length</span><span class="p">]</span>

        <span class="n">int_delay</span> <span class="o">=</span> <span class="n">int_delay</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">delayed_1</span> <span class="o">=</span> <span class="n">delay_bufs</span><span class="p">[:,</span> <span class="n">channel_idxs</span><span class="p">,</span> <span class="p">(</span><span class="n">delay_buf_pos</span> <span class="o">+</span> <span class="n">int_delay</span><span class="p">)</span> <span class="o">%</span> <span class="n">delay_buf_length</span><span class="p">]</span>

        <span class="n">int_delay</span> <span class="o">=</span> <span class="n">int_delay</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
            <span class="n">delayed</span> <span class="o">=</span> <span class="n">delayed_0</span> <span class="o">+</span> <span class="p">(</span><span class="n">delayed_1</span> <span class="o">-</span> <span class="n">delayed_0</span><span class="p">)</span> <span class="o">*</span> <span class="n">frac_delay</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delayed_2</span> <span class="o">=</span> <span class="n">delay_bufs</span><span class="p">[:,</span> <span class="n">channel_idxs</span><span class="p">,</span> <span class="p">(</span><span class="n">delay_buf_pos</span> <span class="o">+</span> <span class="n">int_delay</span><span class="p">)</span> <span class="o">%</span> <span class="n">delay_buf_length</span><span class="p">]</span>

            <span class="n">int_delay</span> <span class="o">=</span> <span class="n">int_delay</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">delayed_2</span> <span class="o">=</span> <span class="n">delayed_2</span> <span class="o">-</span> <span class="n">delayed_0</span>
            <span class="n">delayed_1</span> <span class="o">=</span> <span class="n">delayed_1</span> <span class="o">-</span> <span class="n">delayed_0</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">delayed_2</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="n">delayed_1</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">delayed_1</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">delayed_2</span> <span class="o">*</span> <span class="mf">0.5</span>

            <span class="n">delayed</span> <span class="o">=</span> <span class="n">delayed_0</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">frac_delay</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">frac_delay</span>

        <span class="n">delay_last</span> <span class="o">=</span> <span class="n">delayed</span>
        <span class="n">output_waveform</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">waveform</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">in_gain</span> <span class="o">+</span> <span class="n">delayed</span> <span class="o">*</span> <span class="n">delay_gain</span>

        <span class="n">lfo_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">lfo_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">lfo_length</span>

    <span class="k">return</span> <span class="n">output_waveform</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">actual_shape</span><span class="p">)</span></div>


<div class="viewcode-block" id="gain"><a class="viewcode-back" href="../../../generated/torchaudio.functional.gain.html#torchaudio.functional.gain">[docs]</a><span class="k">def</span> <span class="nf">gain</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">gain_db</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply amplification or attenuation to the whole waveform.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">       waveform (Tensor): Tensor of audio of dimension (..., time).</span>
<span class="sd">       gain_db (float, optional) Gain adjustment in decibels (dB) (Default: ``1.0``).</span>

<span class="sd">    Returns:</span>
<span class="sd">       Tensor: the whole waveform amplified by gain_db.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">gain_db</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">waveform</span>

    <span class="n">ratio</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">gain_db</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">waveform</span> <span class="o">*</span> <span class="n">ratio</span></div>


<div class="viewcode-block" id="highpass_biquad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.highpass_biquad.html#torchaudio.functional.highpass_biquad">[docs]</a><span class="k">def</span> <span class="nf">highpass_biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">cutoff_freq</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.707</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Design biquad highpass filter and perform filtering.  Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, e.g. 44100 (Hz)</span>
<span class="sd">        cutoff_freq (float or torch.Tensor): filter cutoff frequency</span>
<span class="sd">        Q (float or torch.Tensor, optional): https://en.wikipedia.org/wiki/Q_factor (Default: ``0.707``)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform dimension of `(..., time)`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span>
    <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">w0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cutoff_freq</span> <span class="o">/</span> <span class="n">sample_rate</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">Q</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">b0</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span>
    <span class="k">return</span> <span class="n">biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_lfilter_core_generic_loop</span><span class="p">(</span><span class="n">input_signal_windows</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">a_coeffs_flipped</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">padded_output_waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">):</span>
    <span class="n">n_order</span> <span class="o">=</span> <span class="n">a_coeffs_flipped</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">a_coeffs_flipped</span> <span class="o">=</span> <span class="n">a_coeffs_flipped</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i_sample</span><span class="p">,</span> <span class="n">o0</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">input_signal_windows</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">windowed_output_signal</span> <span class="o">=</span> <span class="n">padded_output_waveform</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i_sample</span> <span class="p">:</span> <span class="n">i_sample</span> <span class="o">+</span> <span class="n">n_order</span><span class="p">]</span>
        <span class="n">o0</span> <span class="o">-=</span> <span class="p">(</span><span class="n">windowed_output_signal</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">@</span> <span class="n">a_coeffs_flipped</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">()</span>
        <span class="n">padded_output_waveform</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i_sample</span> <span class="o">+</span> <span class="n">n_order</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">o0</span>


<span class="k">if</span> <span class="n">_IS_TORCHAUDIO_EXT_AVAILABLE</span><span class="p">:</span>
    <span class="n">_lfilter_core_cpu_loop</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">torchaudio</span><span class="o">.</span><span class="n">_lfilter_core_loop</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_lfilter_core_cpu_loop</span> <span class="o">=</span> <span class="n">_lfilter_core_generic_loop</span>


<span class="k">def</span> <span class="nf">_lfilter_core</span><span class="p">(</span>
    <span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">a_coeffs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">b_coeffs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>

    <span class="k">if</span> <span class="n">a_coeffs</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">b_coeffs</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expected coeffs to be the same size.&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Found a_coeffs size: </span><span class="si">{</span><span class="n">a_coeffs</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="si">}</span><span class="s2">, b_coeffs size: </span><span class="si">{</span><span class="n">b_coeffs</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">waveform</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected waveform to be 3 dimensional. Found: </span><span class="si">{</span><span class="n">waveform</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="n">a_coeffs</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="n">b_coeffs</span><span class="o">.</span><span class="n">device</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expected waveform and coeffs to be on the same device.&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Found: waveform device:</span><span class="si">{</span><span class="n">waveform</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">, a_coeffs device: </span><span class="si">{</span><span class="n">a_coeffs</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;b_coeffs device: </span><span class="si">{</span><span class="n">b_coeffs</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">n_batch</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">,</span> <span class="n">n_sample</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="n">n_order</span> <span class="o">=</span> <span class="n">a_coeffs</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_order</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected n_order to be positive. Found: </span><span class="si">{</span><span class="n">n_order</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Pad the input and create output</span>

    <span class="n">padded_waveform</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="p">[</span><span class="n">n_order</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">padded_output_waveform</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">padded_waveform</span><span class="p">)</span>

    <span class="c1"># Set up the coefficients matrix</span>
    <span class="c1"># Flip coefficients&#39; order</span>
    <span class="n">a_coeffs_flipped</span> <span class="o">=</span> <span class="n">a_coeffs</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">b_coeffs_flipped</span> <span class="o">=</span> <span class="n">b_coeffs</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># calculate windowed_input_signal in parallel using convolution</span>
    <span class="n">input_signal_windows</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv1d</span><span class="p">(</span><span class="n">padded_waveform</span><span class="p">,</span> <span class="n">b_coeffs_flipped</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">groups</span><span class="o">=</span><span class="n">n_channel</span><span class="p">)</span>

    <span class="n">input_signal_windows</span><span class="o">.</span><span class="n">div_</span><span class="p">(</span><span class="n">a_coeffs</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">a_coeffs_flipped</span><span class="o">.</span><span class="n">div_</span><span class="p">(</span><span class="n">a_coeffs</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">input_signal_windows</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">a_coeffs_flipped</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">padded_output_waveform</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">_lfilter_core_cpu_loop</span><span class="p">(</span><span class="n">input_signal_windows</span><span class="p">,</span> <span class="n">a_coeffs_flipped</span><span class="p">,</span> <span class="n">padded_output_waveform</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_lfilter_core_generic_loop</span><span class="p">(</span><span class="n">input_signal_windows</span><span class="p">,</span> <span class="n">a_coeffs_flipped</span><span class="p">,</span> <span class="n">padded_output_waveform</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">padded_output_waveform</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">n_order</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:]</span>
    <span class="k">return</span> <span class="n">output</span>


<span class="k">if</span> <span class="n">_IS_TORCHAUDIO_EXT_AVAILABLE</span><span class="p">:</span>
    <span class="n">_lfilter</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">torchaudio</span><span class="o">.</span><span class="n">_lfilter</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_lfilter</span> <span class="o">=</span> <span class="n">_lfilter_core</span>


<div class="viewcode-block" id="lfilter"><a class="viewcode-back" href="../../../generated/torchaudio.functional.lfilter.html#torchaudio.functional.lfilter">[docs]</a><span class="k">def</span> <span class="nf">lfilter</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">a_coeffs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">b_coeffs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">clamp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">batching</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Perform an IIR filter by evaluating difference equation, using differentiable implementation</span>
<span class="sd">    developed independently by *Yu et al.* :cite:`ismir_YuF23` and *Forgione et al.* :cite:`forgione2021dynonet`.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Note:</span>
<span class="sd">        To avoid numerical problems, small filter order is preferred.</span>
<span class="sd">        Using double precision could also minimize numerical precision errors.</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`.  Must be normalized to -1 to 1.</span>
<span class="sd">        a_coeffs (Tensor): denominator coefficients of difference equation of dimension of either</span>
<span class="sd">                                1D with shape `(num_order + 1)` or 2D with shape `(num_filters, num_order + 1)`.</span>
<span class="sd">                                Lower delays coefficients are first, e.g. ``[a0, a1, a2, ...]``.</span>
<span class="sd">                                Must be same size as b_coeffs (pad with 0&#39;s as necessary).</span>
<span class="sd">        b_coeffs (Tensor): numerator coefficients of difference equation of dimension of either</span>
<span class="sd">                                1D with shape `(num_order + 1)` or 2D with shape `(num_filters, num_order + 1)`.</span>
<span class="sd">                                Lower delays coefficients are first, e.g. ``[b0, b1, b2, ...]``.</span>
<span class="sd">                                Must be same size as a_coeffs (pad with 0&#39;s as necessary).</span>
<span class="sd">        clamp (bool, optional): If ``True``, clamp the output signal to be in the range [-1, 1] (Default: ``True``)</span>
<span class="sd">        batching (bool, optional): Effective only when coefficients are 2D. If ``True``, then waveform should be at</span>
<span class="sd">                                    least 2D, and the size of second axis from last should equals to ``num_filters``.</span>
<span class="sd">                                    The output can be expressed as ``output[..., i, :] = lfilter(waveform[..., i, :],</span>
<span class="sd">                                    a_coeffs[i], b_coeffs[i], clamp=clamp, batching=False)``. (Default: ``True``)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform with dimension of either `(..., num_filters, time)` if ``a_coeffs`` and ``b_coeffs``</span>
<span class="sd">        are 2D Tensors, or `(..., time)` otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">a_coeffs</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">b_coeffs</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expected coeffs to be the same size.&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Found: a_coeffs size: </span><span class="si">{</span><span class="n">a_coeffs</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="si">}</span><span class="s2">, b_coeffs size: </span><span class="si">{</span><span class="n">b_coeffs</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">a_coeffs</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected coeffs to have greater than 1 dimension. Found: </span><span class="si">{</span><span class="n">a_coeffs</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">a_coeffs</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">batching</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">waveform</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected waveform to have a positive number of dimensions.&quot;</span> <span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">waveform</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">a_coeffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Expected number of batches in waveform and coeffs to be the same.&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Found: coeffs batches: </span><span class="si">{</span><span class="n">a_coeffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, waveform batches: </span><span class="si">{</span><span class="n">waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">waveform</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">waveform</span><span class="p">]</span> <span class="o">*</span> <span class="n">a_coeffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a_coeffs</span> <span class="o">=</span> <span class="n">a_coeffs</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">b_coeffs</span> <span class="o">=</span> <span class="n">b_coeffs</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># pack batch</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">a_coeffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">_lfilter</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">a_coeffs</span><span class="p">,</span> <span class="n">b_coeffs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">clamp</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># unpack batch</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="lowpass_biquad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.lowpass_biquad.html#torchaudio.functional.lowpass_biquad">[docs]</a><span class="k">def</span> <span class="nf">lowpass_biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">cutoff_freq</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.707</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Design biquad lowpass filter and perform filtering.  Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (torch.Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, e.g. 44100 (Hz)</span>
<span class="sd">        cutoff_freq (float or torch.Tensor): filter cutoff frequency</span>
<span class="sd">        Q (float or torch.Tensor, optional): https://en.wikipedia.org/wiki/Q_factor (Default: ``0.707``)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span>
    <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">w0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cutoff_freq</span> <span class="o">/</span> <span class="n">sample_rate</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">Q</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">b0</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span>
    <span class="k">return</span> <span class="n">biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_overdrive_core_loop_generic</span><span class="p">(</span>
    <span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">temp</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">last_in</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">last_out</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">output_waveform</span><span class="p">:</span> <span class="n">Tensor</span>
<span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">last_out</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">last_in</span> <span class="o">+</span> <span class="mf">0.995</span> <span class="o">*</span> <span class="n">last_out</span>
        <span class="n">last_in</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">output_waveform</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">waveform</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">last_out</span> <span class="o">*</span> <span class="mf">0.75</span>


<span class="k">if</span> <span class="n">_IS_TORCHAUDIO_EXT_AVAILABLE</span><span class="p">:</span>
    <span class="n">_overdrive_core_loop_cpu</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">torchaudio</span><span class="o">.</span><span class="n">_overdrive_core_loop</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_overdrive_core_loop_cpu</span> <span class="o">=</span> <span class="n">_overdrive_core_loop_generic</span>


<div class="viewcode-block" id="overdrive"><a class="viewcode-back" href="../../../generated/torchaudio.functional.overdrive.html#torchaudio.functional.overdrive">[docs]</a><span class="k">def</span> <span class="nf">overdrive</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">gain</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">colour</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply a overdrive effect to the audio. Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    This effect applies a non linear distortion to the audio signal.</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        gain (float, optional): desired gain at the boost (or attenuation) in dB</span>
<span class="sd">            Allowed range of values are 0 to 100</span>
<span class="sd">        colour (float, optional):  controls the amount of even harmonic content in the over-driven output</span>
<span class="sd">            Allowed range of values are 0 to 100</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">actual_shape</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">device</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>

    <span class="c1"># convert to 2D (..,time)</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">actual_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">gain</span> <span class="o">=</span> <span class="n">_dB2Linear</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span>
    <span class="n">colour</span> <span class="o">=</span> <span class="n">colour</span> <span class="o">/</span> <span class="mi">200</span>
    <span class="n">last_in</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">last_out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="n">waveform</span> <span class="o">*</span> <span class="n">gain</span> <span class="o">+</span> <span class="n">colour</span>

    <span class="n">mask1</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">temp</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="c1"># Wrapping the constant with Tensor is required for Torchscript</span>

    <span class="n">mask2</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="n">temp</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">mask3</span> <span class="o">=</span> <span class="o">~</span><span class="n">mask1</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mask2</span>
    <span class="n">temp</span><span class="p">[</span><span class="n">mask3</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="n">mask3</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">mask3</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">output_waveform</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="c1"># Uses CPU optimized loop function if available for CPU device</span>
    <span class="k">if</span> <span class="n">device</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">):</span>
        <span class="n">_overdrive_core_loop_cpu</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">last_in</span><span class="p">,</span> <span class="n">last_out</span><span class="p">,</span> <span class="n">output_waveform</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_overdrive_core_loop_generic</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">last_in</span><span class="p">,</span> <span class="n">last_out</span><span class="p">,</span> <span class="n">output_waveform</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_waveform</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">actual_shape</span><span class="p">)</span></div>


<div class="viewcode-block" id="phaser"><a class="viewcode-back" href="../../../generated/torchaudio.functional.phaser.html#torchaudio.functional.phaser">[docs]</a><span class="k">def</span> <span class="nf">phaser</span><span class="p">(</span>
    <span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">gain_in</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
    <span class="n">gain_out</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.74</span><span class="p">,</span>
    <span class="n">delay_ms</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
    <span class="n">decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
    <span class="n">mod_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">sinusoidal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply a phasing effect to the audio. Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, e.g. 44100 (Hz)</span>
<span class="sd">        gain_in (float, optional): desired input gain at the boost (or attenuation) in dB</span>
<span class="sd">            Allowed range of values are 0 to 1</span>
<span class="sd">        gain_out (float, optional): desired output gain at the boost (or attenuation) in dB</span>
<span class="sd">            Allowed range of values are 0 to 1e9</span>
<span class="sd">        delay_ms (float, optional): desired delay in milliseconds</span>
<span class="sd">            Allowed range of values are 0 to 5.0</span>
<span class="sd">        decay (float, optional):  desired decay relative to gain-in</span>
<span class="sd">            Allowed range of values are 0 to 0.99</span>
<span class="sd">        mod_speed (float, optional):  modulation speed in Hz</span>
<span class="sd">            Allowed range of values are 0.1 to 2</span>
<span class="sd">        sinusoidal (bool, optional):  If ``True``, uses sinusoidal modulation (preferable for multiple instruments)</span>
<span class="sd">            If ``False``, uses triangular modulation (gives single instruments a sharper phasing effect)</span>
<span class="sd">            (Default: ``True``)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">        - Scott Lehman, `Effects Explained`_.</span>

<span class="sd">    .. _Effects Explained:</span>
<span class="sd">        https://web.archive.org/web/20051125072557/http://www.harmony-central.com/Effects/effects-explained.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">actual_shape</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">device</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>

    <span class="c1"># convert to 2D (channels,time)</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">actual_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">delay_buf_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">delay_ms</span> <span class="o">*</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">sample_rate</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">delay_buf</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">delay_buf_len</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">mod_buf_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample_rate</span> <span class="o">/</span> <span class="n">mod_speed</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sinusoidal</span><span class="p">:</span>
        <span class="n">wave_type</span> <span class="o">=</span> <span class="s2">&quot;SINE&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wave_type</span> <span class="o">=</span> <span class="s2">&quot;TRIANGLE&quot;</span>

    <span class="n">mod_buf</span> <span class="o">=</span> <span class="n">_generate_wave_table</span><span class="p">(</span>
        <span class="n">wave_type</span><span class="o">=</span><span class="n">wave_type</span><span class="p">,</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;INT&quot;</span><span class="p">,</span>
        <span class="n">table_size</span><span class="o">=</span><span class="n">mod_buf_len</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">delay_buf_len</span><span class="p">),</span>
        <span class="n">phase</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">delay_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mod_pos</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">output_waveform_pre_gain_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">waveform</span> <span class="o">*</span> <span class="n">gain_in</span>
    <span class="n">delay_buf</span> <span class="o">=</span> <span class="n">delay_buf</span> <span class="o">*</span> <span class="n">decay</span>
    <span class="n">waveform_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">waveform</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">))]</span>
    <span class="n">delay_buf_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">delay_buf</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delay_buf</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">))]</span>
    <span class="n">mod_buf_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">mod_buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mod_buf</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">))]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">delay_pos</span> <span class="o">+</span> <span class="n">mod_buf_list</span><span class="p">[</span><span class="n">mod_pos</span><span class="p">])</span> <span class="o">%</span> <span class="n">delay_buf_len</span><span class="p">)</span>
        <span class="n">mod_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">mod_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">mod_buf_len</span>
        <span class="n">delay_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">delay_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">delay_buf_len</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">waveform_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">delay_buf_list</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">delay_buf_list</span><span class="p">[</span><span class="n">delay_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">decay</span>
        <span class="n">output_waveform_pre_gain_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

    <span class="n">output_waveform</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">output_waveform_pre_gain_list</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">output_waveform</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="n">gain_out</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_waveform</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">actual_shape</span><span class="p">)</span></div>


<div class="viewcode-block" id="riaa_biquad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.riaa_biquad.html#torchaudio.functional.riaa_biquad">[docs]</a><span class="k">def</span> <span class="nf">riaa_biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply RIAA vinyl playback equalization.  Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, e.g. 44100 (Hz).</span>
<span class="sd">            Allowed sample rates in Hz : ``44100``,``48000``,``88200``,``96000``</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">        - https://www.w3.org/2011/audio/audio-eq-cookbook.html#APF</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">sample_rate</span> <span class="o">==</span> <span class="mi">44100</span><span class="p">:</span>
        <span class="n">zeros</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.2014898</span><span class="p">,</span> <span class="mf">0.9233820</span><span class="p">]</span>
        <span class="n">poles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.7083149</span><span class="p">,</span> <span class="mf">0.9924091</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">sample_rate</span> <span class="o">==</span> <span class="mi">48000</span><span class="p">:</span>
        <span class="n">zeros</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1766069</span><span class="p">,</span> <span class="mf">0.9321590</span><span class="p">]</span>
        <span class="n">poles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.7396325</span><span class="p">,</span> <span class="mf">0.9931330</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">sample_rate</span> <span class="o">==</span> <span class="mi">88200</span><span class="p">:</span>
        <span class="n">zeros</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1168735</span><span class="p">,</span> <span class="mf">0.9648312</span><span class="p">]</span>
        <span class="n">poles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8590646</span><span class="p">,</span> <span class="mf">0.9964002</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">sample_rate</span> <span class="o">==</span> <span class="mi">96000</span><span class="p">:</span>
        <span class="n">zeros</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1141486</span><span class="p">,</span> <span class="mf">0.9676817</span><span class="p">]</span>
        <span class="n">poles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8699137</span><span class="p">,</span> <span class="mf">0.9966946</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sample rate must be 44.1k, 48k, 88.2k, or 96k&quot;</span><span class="p">)</span>

    <span class="c1"># polynomial coefficients with roots zeros[0] and zeros[1]</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">zeros</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">zeros</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">zeros</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># polynomial coefficients with roots poles[0] and poles[1]</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">poles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">poles</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">poles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">poles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Normalize to 0dB at 1kHz</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">sample_rate</span>
    <span class="n">b_re</span> <span class="o">=</span> <span class="n">b0</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">a_re</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">+</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">b_im</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">a_im</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">b_re</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b_im</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a_re</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a_im</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">b0</span> <span class="o">*=</span> <span class="n">g</span>
    <span class="n">b1</span> <span class="o">*=</span> <span class="n">g</span>
    <span class="n">b2</span> <span class="o">*=</span> <span class="n">g</span>

    <span class="k">return</span> <span class="n">biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></div>


<div class="viewcode-block" id="treble_biquad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.treble_biquad.html#torchaudio.functional.treble_biquad">[docs]</a><span class="k">def</span> <span class="nf">treble_biquad</span><span class="p">(</span>
    <span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">gain</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">central_freq</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>
    <span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.707</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Design a treble tone-control effect.  Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: Autograd TorchScript</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): audio waveform of dimension of `(..., time)`</span>
<span class="sd">        sample_rate (int): sampling rate of the waveform, e.g. 44100 (Hz)</span>
<span class="sd">        gain (float or torch.Tensor): desired gain at the boost (or attenuation) in dB.</span>
<span class="sd">        central_freq (float or torch.Tensor, optional): central frequency (in Hz). (Default: ``3000``)</span>
<span class="sd">        Q (float or torch.Tensor, optional): https://en.wikipedia.org/wiki/Q_factor (Default: ``0.707``).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Waveform of dimension of `(..., time)`</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">        - https://www.w3.org/2011/audio/audio-eq-cookbook.html#APF</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span>
    <span class="n">central_freq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">central_freq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">gain</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">w0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">central_freq</span> <span class="o">/</span> <span class="n">sample_rate</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">Q</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">gain</span> <span class="o">/</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">temp1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha</span>
    <span class="n">temp2</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">temp3</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">temp2</span> <span class="o">+</span> <span class="n">temp1</span><span class="p">)</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="p">((</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">temp3</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">temp2</span> <span class="o">-</span> <span class="n">temp1</span><span class="p">)</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp2</span> <span class="o">+</span> <span class="n">temp1</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp3</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp2</span> <span class="o">-</span> <span class="n">temp1</span>

    <span class="k">return</span> <span class="n">biquad</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_measure</span><span class="p">(</span>
    <span class="n">measure_len_ws</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">samples</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">spectrum</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">noise_spectrum</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">spectrum_window</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">spectrum_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">spectrum_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">cepstrum_window</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">cepstrum_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">cepstrum_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">noise_reduction_amount</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">measure_smooth_time_mult</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">noise_up_time_mult</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">noise_down_time_mult</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">boot_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">device</span>

    <span class="k">if</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">noise_spectrum</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expected spectrum size to match noise spectrum size in final dimension.&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Found: spectrum size: </span><span class="si">{</span><span class="n">spectrum</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="si">}</span><span class="s2">, noise_spectrum size: </span><span class="si">{</span><span class="n">noise_spectrum</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">dft_len_ws</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">dftBuf</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dft_len_ws</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">dftBuf</span><span class="p">[:</span><span class="n">measure_len_ws</span><span class="p">]</span> <span class="o">=</span> <span class="n">samples</span> <span class="o">*</span> <span class="n">spectrum_window</span><span class="p">[:</span><span class="n">measure_len_ws</span><span class="p">]</span>

    <span class="c1"># lsx_safe_rdft((int)p-&gt;dft_len_ws, 1, c-&gt;dftBuf);</span>
    <span class="n">_dftBuf</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">dftBuf</span><span class="p">)</span>

    <span class="n">mult</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">boot_count</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">boot_count</span><span class="p">)</span> <span class="k">if</span> <span class="n">boot_count</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">measure_smooth_time_mult</span>

    <span class="n">_d</span> <span class="o">=</span> <span class="n">_dftBuf</span><span class="p">[</span><span class="n">spectrum_start</span><span class="p">:</span><span class="n">spectrum_end</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
    <span class="n">spectrum</span><span class="p">[</span><span class="n">spectrum_start</span><span class="p">:</span><span class="n">spectrum_end</span><span class="p">]</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="n">mult</span><span class="p">)</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="n">_d</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mult</span><span class="p">))</span>
    <span class="n">_d</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">[</span><span class="n">spectrum_start</span><span class="p">:</span><span class="n">spectrum_end</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="n">_zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">spectrum_end</span> <span class="o">-</span> <span class="n">spectrum_start</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">_mult</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">_zeros</span>
        <span class="k">if</span> <span class="n">boot_count</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">_d</span> <span class="o">&gt;</span> <span class="n">noise_spectrum</span><span class="p">[</span><span class="n">spectrum_start</span><span class="p">:</span><span class="n">spectrum_end</span><span class="p">],</span>
            <span class="n">noise_up_time_mult</span><span class="p">,</span>  <span class="c1"># if</span>
            <span class="n">noise_down_time_mult</span><span class="p">,</span>  <span class="c1"># else,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">noise_spectrum</span><span class="p">[</span><span class="n">spectrum_start</span><span class="p">:</span><span class="n">spectrum_end</span><span class="p">]</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="n">_mult</span><span class="p">)</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="n">_d</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">_mult</span><span class="p">))</span>
    <span class="n">_d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
            <span class="n">_zeros</span><span class="p">,</span>
            <span class="n">_d</span> <span class="o">-</span> <span class="n">noise_reduction_amount</span> <span class="o">*</span> <span class="n">noise_spectrum</span><span class="p">[</span><span class="n">spectrum_start</span><span class="p">:</span><span class="n">spectrum_end</span><span class="p">],</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">_cepstrum_Buf</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dft_len_ws</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">_cepstrum_Buf</span><span class="p">[</span><span class="n">spectrum_start</span><span class="p">:</span><span class="n">spectrum_end</span><span class="p">]</span> <span class="o">=</span> <span class="n">_d</span> <span class="o">*</span> <span class="n">cepstrum_window</span>
    <span class="n">_cepstrum_Buf</span><span class="p">[</span><span class="n">spectrum_end</span> <span class="p">:</span> <span class="n">dft_len_ws</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>

    <span class="c1"># lsx_safe_rdft((int)p-&gt;dft_len_ws &gt;&gt; 1, 1, c-&gt;dftBuf);</span>
    <span class="n">_cepstrum_Buf</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">_cepstrum_Buf</span><span class="p">)</span>

    <span class="n">result</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">_cepstrum_Buf</span><span class="p">[</span><span class="n">cepstrum_start</span><span class="p">:</span><span class="n">cepstrum_end</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">result</span> <span class="o">/</span> <span class="p">(</span><span class="n">cepstrum_end</span> <span class="o">-</span> <span class="n">cepstrum_start</span><span class="p">))</span> <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">21</span> <span class="o">+</span> <span class="n">result</span><span class="p">)</span>


<div class="viewcode-block" id="vad"><a class="viewcode-back" href="../../../generated/torchaudio.functional.vad.html#torchaudio.functional.vad">[docs]</a><span class="k">def</span> <span class="nf">vad</span><span class="p">(</span>
    <span class="n">waveform</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">trigger_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">7.0</span><span class="p">,</span>
    <span class="n">trigger_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">search_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">allowed_gap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">pre_trigger_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="c1"># Fine-tuning parameters</span>
    <span class="n">boot_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.35</span><span class="p">,</span>
    <span class="n">noise_up_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">noise_down_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">noise_reduction_amount</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.35</span><span class="p">,</span>
    <span class="n">measure_freq</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20.0</span><span class="p">,</span>
    <span class="n">measure_duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">measure_smooth_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
    <span class="n">hp_filter_freq</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">,</span>
    <span class="n">lp_filter_freq</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">6000.0</span><span class="p">,</span>
    <span class="n">hp_lifter_freq</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">150.0</span><span class="p">,</span>
    <span class="n">lp_lifter_freq</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2000.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Voice Activity Detector. Similar to SoX implementation.</span>

<span class="sd">    .. devices:: CPU CUDA</span>

<span class="sd">    .. properties:: TorchScript</span>

<span class="sd">    Attempts to trim silence and quiet background sounds from the ends of recordings of speech.</span>
<span class="sd">    The algorithm currently uses a simple cepstral power measurement to detect voice,</span>
<span class="sd">    so may be fooled by other things, especially music.</span>

<span class="sd">    The effect can trim only from the front of the audio,</span>
<span class="sd">    so in order to trim from the back, the reverse effect must also be used.</span>

<span class="sd">    Args:</span>
<span class="sd">        waveform (Tensor): Tensor of audio of dimension `(channels, time)` or `(time)`</span>
<span class="sd">            Tensor of shape `(channels, time)` is treated as a multi-channel recording</span>
<span class="sd">            of the same event and the resulting output will be trimmed to the earliest</span>
<span class="sd">            voice activity in any channel.</span>
<span class="sd">        sample_rate (int): Sample rate of audio signal.</span>
<span class="sd">        trigger_level (float, optional): The measurement level used to trigger activity detection.</span>
<span class="sd">            This may need to be cahnged depending on the noise level, signal level,</span>
<span class="sd">            and other characteristics of the input audio. (Default: 7.0)</span>
<span class="sd">        trigger_time (float, optional): The time constant (in seconds)</span>
<span class="sd">            used to help ignore short bursts of sound. (Default: 0.25)</span>
<span class="sd">        search_time (float, optional): The amount of audio (in seconds)</span>
<span class="sd">            to search for quieter/shorter bursts of audio to include prior</span>
<span class="sd">            to the detected trigger point. (Default: 1.0)</span>
<span class="sd">        allowed_gap (float, optional): The allowed gap (in seconds) between</span>
<span class="sd">            quieter/shorter bursts of audio to include prior</span>
<span class="sd">            to the detected trigger point. (Default: 0.25)</span>
<span class="sd">        pre_trigger_time (float, optional): The amount of audio (in seconds) to preserve</span>
<span class="sd">            before the trigger point and any found quieter/shorter bursts. (Default: 0.0)</span>
<span class="sd">        boot_time (float, optional) The algorithm (internally) uses adaptive noise</span>
<span class="sd">            estimation/reduction in order to detect the start of the wanted audio.</span>
<span class="sd">            This option sets the time for the initial noise estimate. (Default: 0.35)</span>
<span class="sd">        noise_up_time (float, optional) Time constant used by the adaptive noise estimator</span>
<span class="sd">            for when the noise level is increasing. (Default: 0.1)</span>
<span class="sd">        noise_down_time (float, optional) Time constant used by the adaptive noise estimator</span>
<span class="sd">            for when the noise level is decreasing. (Default: 0.01)</span>
<span class="sd">        noise_reduction_amount (float, optional) Amount of noise reduction to use in</span>
<span class="sd">            the detection algorithm (e.g. 0, 0.5, ...). (Default: 1.35)</span>
<span class="sd">        measure_freq (float, optional) Frequency of the algorithm&#39;s</span>
<span class="sd">            processing/measurements. (Default: 20.0)</span>
<span class="sd">        measure_duration: (float, optional) Measurement duration.</span>
<span class="sd">            (Default: Twice the measurement period; i.e. with overlap.)</span>
<span class="sd">        measure_smooth_time (float, optional) Time constant used to smooth</span>
<span class="sd">            spectral measurements. (Default: 0.4)</span>
<span class="sd">        hp_filter_freq (float, optional) &quot;Brick-wall&quot; frequency of high-pass filter applied</span>
<span class="sd">            at the input to the detector algorithm. (Default: 50.0)</span>
<span class="sd">        lp_filter_freq (float, optional) &quot;Brick-wall&quot; frequency of low-pass filter applied</span>
<span class="sd">            at the input to the detector algorithm. (Default: 6000.0)</span>
<span class="sd">        hp_lifter_freq (float, optional) &quot;Brick-wall&quot; frequency of high-pass lifter used</span>
<span class="sd">            in the detector algorithm. (Default: 150.0)</span>
<span class="sd">        lp_lifter_freq (float, optional) &quot;Brick-wall&quot; frequency of low-pass lifter used</span>
<span class="sd">            in the detector algorithm. (Default: 2000.0)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tensor: Tensor of audio of dimension `(..., time)`.</span>

<span class="sd">    Reference:</span>
<span class="sd">        - http://sox.sourceforge.net/sox.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">device</span>

    <span class="k">if</span> <span class="n">waveform</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Expected input tensor dimension of 1 for single channel&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; or 2 for multi-channel. Got </span><span class="si">{</span><span class="n">waveform</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> instead. &quot;</span>
            <span class="s2">&quot;Batch semantics is not supported. &quot;</span>
            <span class="s2">&quot;Please refer to https://github.com/pytorch/audio/issues/1348&quot;</span>
            <span class="s2">&quot; and https://github.com/pytorch/audio/issues/1468.&quot;</span>
        <span class="p">)</span>

    <span class="n">measure_duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">measure_freq</span> <span class="k">if</span> <span class="n">measure_duration</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">measure_duration</span>

    <span class="n">measure_len_ws</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample_rate</span> <span class="o">*</span> <span class="n">measure_duration</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">measure_len_ns</span> <span class="o">=</span> <span class="n">measure_len_ws</span>
    <span class="c1"># for (dft_len_ws = 16; dft_len_ws &lt; measure_len_ws; dft_len_ws &lt;&lt;= 1);</span>
    <span class="n">dft_len_ws</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="k">while</span> <span class="n">dft_len_ws</span> <span class="o">&lt;</span> <span class="n">measure_len_ws</span><span class="p">:</span>
        <span class="n">dft_len_ws</span> <span class="o">*=</span> <span class="mi">2</span>

    <span class="n">measure_period_ns</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample_rate</span> <span class="o">/</span> <span class="n">measure_freq</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">measures_len</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">search_time</span> <span class="o">*</span> <span class="n">measure_freq</span><span class="p">)</span>
    <span class="n">search_pre_trigger_len_ns</span> <span class="o">=</span> <span class="n">measures_len</span> <span class="o">*</span> <span class="n">measure_period_ns</span>
    <span class="n">gap_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">allowed_gap</span> <span class="o">*</span> <span class="n">measure_freq</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>

    <span class="n">fixed_pre_trigger_len_ns</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pre_trigger_time</span> <span class="o">*</span> <span class="n">sample_rate</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">samplesLen_ns</span> <span class="o">=</span> <span class="n">fixed_pre_trigger_len_ns</span> <span class="o">+</span> <span class="n">search_pre_trigger_len_ns</span> <span class="o">+</span> <span class="n">measure_len_ns</span>

    <span class="n">spectrum_window</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">measure_len_ws</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">measure_len_ws</span><span class="p">):</span>
        <span class="c1"># sox.h:741 define SOX_SAMPLE_MIN (sox_sample_t)SOX_INT_MIN(32)</span>
        <span class="n">spectrum_window</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">measure_len_ws</span><span class="p">))</span>
    <span class="c1"># lsx_apply_hann(spectrum_window, (int)measure_len_ws);</span>
    <span class="n">spectrum_window</span> <span class="o">*=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hann_window</span><span class="p">(</span><span class="n">measure_len_ws</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

    <span class="n">spectrum_start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hp_filter_freq</span> <span class="o">/</span> <span class="n">sample_rate</span> <span class="o">*</span> <span class="n">dft_len_ws</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">spectrum_start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">spectrum_start</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">spectrum_end</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lp_filter_freq</span> <span class="o">/</span> <span class="n">sample_rate</span> <span class="o">*</span> <span class="n">dft_len_ws</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">spectrum_end</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">spectrum_end</span><span class="p">,</span> <span class="n">dft_len_ws</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">cepstrum_window</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">spectrum_end</span> <span class="o">-</span> <span class="n">spectrum_start</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">spectrum_end</span> <span class="o">-</span> <span class="n">spectrum_start</span><span class="p">):</span>
        <span class="n">cepstrum_window</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">spectrum_end</span><span class="p">)</span> <span class="o">-</span> <span class="n">spectrum_start</span><span class="p">)</span>
    <span class="c1"># lsx_apply_hann(cepstrum_window,(int)(spectrum_end - spectrum_start));</span>
    <span class="n">cepstrum_window</span> <span class="o">*=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hann_window</span><span class="p">(</span><span class="n">spectrum_end</span> <span class="o">-</span> <span class="n">spectrum_start</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

    <span class="n">cepstrum_start</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">sample_rate</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">lp_lifter_freq</span><span class="p">)</span>
    <span class="n">cepstrum_end</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">sample_rate</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">hp_lifter_freq</span><span class="p">)</span>
    <span class="n">cepstrum_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cepstrum_end</span><span class="p">,</span> <span class="n">dft_len_ws</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cepstrum_end</span> <span class="o">&lt;=</span> <span class="n">cepstrum_start</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expected cepstrum_start to be smaller than cepstrum_end.&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Found: cepstrum_start: </span><span class="si">{</span><span class="n">cepstrum_start</span><span class="si">}</span><span class="s2">, cepstrum_end: </span><span class="si">{</span><span class="n">cepstrum_end</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="n">noise_up_time_mult</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">noise_up_time</span> <span class="o">*</span> <span class="n">measure_freq</span><span class="p">)),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">noise_down_time_mult</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">noise_down_time</span> <span class="o">*</span> <span class="n">measure_freq</span><span class="p">)),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">measure_smooth_time_mult</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">measure_smooth_time</span> <span class="o">*</span> <span class="n">measure_freq</span><span class="p">))</span>
    <span class="n">trigger_meas_time_mult</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">trigger_time</span> <span class="o">*</span> <span class="n">measure_freq</span><span class="p">))</span>

    <span class="n">boot_count_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">boot_time</span> <span class="o">*</span> <span class="n">measure_freq</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">boot_count</span> <span class="o">=</span> <span class="n">measures_index</span> <span class="o">=</span> <span class="n">flushedLen_ns</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># pack batch</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">n_channels</span><span class="p">,</span> <span class="n">ilen</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>

    <span class="n">mean_meas</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">dft_len_ws</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">noise_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">dft_len_ws</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">measures</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">measures_len</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">has_triggered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">num_measures_to_flush</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">measure_len_ns</span><span class="p">,</span> <span class="n">ilen</span><span class="p">,</span> <span class="n">measure_period_ns</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_channels</span><span class="p">):</span>
            <span class="n">meas</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">_measure</span><span class="p">(</span>
                <span class="n">measure_len_ws</span><span class="o">=</span><span class="n">measure_len_ws</span><span class="p">,</span>
                <span class="n">samples</span><span class="o">=</span><span class="n">waveform</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">measure_len_ws</span> <span class="p">:</span> <span class="n">pos</span><span class="p">],</span>
                <span class="n">spectrum</span><span class="o">=</span><span class="n">spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">noise_spectrum</span><span class="o">=</span><span class="n">noise_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">spectrum_window</span><span class="o">=</span><span class="n">spectrum_window</span><span class="p">,</span>
                <span class="n">spectrum_start</span><span class="o">=</span><span class="n">spectrum_start</span><span class="p">,</span>
                <span class="n">spectrum_end</span><span class="o">=</span><span class="n">spectrum_end</span><span class="p">,</span>
                <span class="n">cepstrum_window</span><span class="o">=</span><span class="n">cepstrum_window</span><span class="p">,</span>
                <span class="n">cepstrum_start</span><span class="o">=</span><span class="n">cepstrum_start</span><span class="p">,</span>
                <span class="n">cepstrum_end</span><span class="o">=</span><span class="n">cepstrum_end</span><span class="p">,</span>
                <span class="n">noise_reduction_amount</span><span class="o">=</span><span class="n">noise_reduction_amount</span><span class="p">,</span>
                <span class="n">measure_smooth_time_mult</span><span class="o">=</span><span class="n">measure_smooth_time_mult</span><span class="p">,</span>
                <span class="n">noise_up_time_mult</span><span class="o">=</span><span class="n">noise_up_time_mult</span><span class="p">,</span>
                <span class="n">noise_down_time_mult</span><span class="o">=</span><span class="n">noise_down_time_mult</span><span class="p">,</span>
                <span class="n">boot_count</span><span class="o">=</span><span class="n">boot_count</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">measures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">measures_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">meas</span>
            <span class="n">mean_meas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_meas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">trigger_meas_time_mult</span> <span class="o">+</span> <span class="n">meas</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">trigger_meas_time_mult</span><span class="p">)</span>

            <span class="n">has_triggered</span> <span class="o">=</span> <span class="n">has_triggered</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mean_meas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">trigger_level</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">has_triggered</span><span class="p">:</span>
                <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">measures_len</span>
                <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">measures_index</span>
                <span class="n">jTrigger</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">n</span>
                <span class="n">jZero</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">n</span>
                <span class="n">j</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">measures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">trigger_level</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;=</span> <span class="n">jTrigger</span> <span class="o">+</span> <span class="n">gap_len</span><span class="p">):</span>
                        <span class="n">jZero</span> <span class="o">=</span> <span class="n">jTrigger</span> <span class="o">=</span> <span class="n">j</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">measures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">jTrigger</span> <span class="o">&gt;=</span> <span class="n">jZero</span><span class="p">):</span>
                        <span class="n">jZero</span> <span class="o">=</span> <span class="n">j</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>
                <span class="n">j</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">jZero</span><span class="p">)</span>
                <span class="c1"># num_measures_to_flush = range_limit(j, num_measures_to_flush, n);</span>
                <span class="n">num_measures_to_flush</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">num_measures_to_flush</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">n</span><span class="p">)</span>
            <span class="c1"># end if has_triggered</span>
        <span class="c1"># end for channel</span>
        <span class="n">measures_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">measures_index</span> <span class="o">=</span> <span class="n">measures_index</span> <span class="o">%</span> <span class="n">measures_len</span>
        <span class="k">if</span> <span class="n">boot_count</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">boot_count</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">boot_count</span> <span class="o">==</span> <span class="n">boot_count_max</span> <span class="k">else</span> <span class="n">boot_count</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">has_triggered</span><span class="p">:</span>
            <span class="n">flushedLen_ns</span> <span class="o">=</span> <span class="p">(</span><span class="n">measures_len</span> <span class="o">-</span> <span class="n">num_measures_to_flush</span><span class="p">)</span> <span class="o">*</span> <span class="n">measure_period_ns</span>
            <span class="k">break</span>
    <span class="c1"># end for window</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_triggered</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">waveform</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">0</span><span class="p">]))</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">waveform</span><span class="p">[:,</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">samplesLen_ns</span> <span class="o">+</span> <span class="n">flushedLen_ns</span> <span class="p">:]</span>
    <span class="c1"># unpack batch</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span></div>
</pre></div>

             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2024, Torchaudio Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>


        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
         <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
         <script src="../../../_static/jquery.js"></script>
         <script src="../../../_static/underscore.js"></script>
         <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
         <script src="../../../_static/doctools.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js"></script>
         <script src="../../../_static/katex_autorenderer.js"></script>
     

  

  <script type="text/javascript" src="../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <script type="text/javascript">
    var collapsedSections = ['API Tutorials', 'Pipeline Tutorials', 'Training Recipes']
    </script>
     
    <script type="text/javascript">
      $(document).ready(function() {
	  var downloadNote = $(".sphx-glr-download-link-note.admonition.note");
	  if (downloadNote.length >= 1) {
	      var tutorialUrl = $("#tutorial-type").text();
	      var githubLink = "https://github.com/pytorch/audio/blob/main/examples/"  + tutorialUrl + ".py",
		  notebookLink = $(".reference.download")[1].href,
		  notebookDownloadPath = notebookLink.split('_downloads')[1],
		  colabLink = "https://colab.research.google.com/github/pytorch/audio/blob/gh-pages/main/_downloads" + notebookDownloadPath;

	      $(".pytorch-call-to-action-links a[data-response='Run in Google Colab']").attr("href", colabLink);
	      $(".pytorch-call-to-action-links a[data-response='View on Github']").attr("href", githubLink);
	  }

          var overwrite = function(_) {
              if ($(this).length > 0) {
                  $(this)[0].href = "https://github.com/pytorch/audio"
              }
          }
          // PC
          $(".main-menu a:contains('GitHub')").each(overwrite);
          // Mobile
          $(".main-menu a:contains('Github')").each(overwrite);
      });

      
       $(window).ready(function() {
           var original = window.sideMenus.bind;
           var startup = true;
           window.sideMenus.bind = function() {
               original();
               if (startup) {
                   $("#pytorch-right-menu a.reference.internal").each(function(i) {
                       if (this.classList.contains("not-expanded")) {
                           this.nextElementSibling.style.display = "block";
                           this.classList.remove("not-expanded");
                           this.classList.add("expanded");
                       }
                   });
                   startup = false;
               }
           };
       });
    </script>

    


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">Stay up to date</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">Facebook</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">Twitter</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">LinkedIn</a></li>
          </ul>  
          </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch Podcasts</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">Apple</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">Google</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">Amazon</a></li>
          </ul>
         </div>
        </div>
        
        <div class="privacy-policy">
          <ul>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">Terms</a></li>
            <li class="privacy-policy-links">|</li>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">Privacy</a></li>
          </ul>
        </div>
        <div class="copyright">
        <p>Â© Copyright The Linux Foundation. The PyTorch Foundation is a project of The Linux Foundation.
          For web site terms of use, trademark policy and other policies applicable to The PyTorch Foundation please see
          <a href="www.linuxfoundation.org/policies/">www.linuxfoundation.org/policies/</a>. The PyTorch Foundation supports the PyTorch open source
          project, which has been established as PyTorch Project a Series of LF Projects, LLC. For policies applicable to the PyTorch Project a Series of LF Projects, LLC,
          please see <a href="www.lfprojects.org/policies/">www.lfprojects.org/policies/</a>.</p>
      </div>
     </div>

  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebookâ€™s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../../../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>
            
          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/torcharrow">torcharrow</a>
            </li>

            <li>
              <a href="https://pytorch.org/data">TorchData</a>
            </li>

            <li>
              <a href="https://pytorch.org/torchrec">TorchRec</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/torchx/">TorchX</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>
            
           <ul class="resources-mobile-menu-items">

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/foundation">PyTorch Foundation</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://pytorch.org/community-stories">Community Stories</a>
            </li>

            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/events">Events</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>