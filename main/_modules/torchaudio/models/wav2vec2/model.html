


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>torchaudio.models.wav2vec2.model &mdash; Torchaudio nightly documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/katex-math.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <!-- Google Analytics -->
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117752657-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-117752657-2');
    </script>
  
  <!-- End Google Analytics -->
  

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchrec">
                  <span class="dropdown-title">TorchRec</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/data">
                  <span class="dropdown-title">TorchData</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchx/">
                  <span class="dropdown-title">TorchX</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorchâ€™s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href="../../../../../versions.html">Nightly Build (0.13.0.dev20221016) &#x25BC</a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Torchaudio Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../supported_features.html">Supported Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../references.html">References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../torchaudio.html">torchaudio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../io.html">torchaudio.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backend.html">torchaudio.backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional.html">torchaudio.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../transforms.html">torchaudio.transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../datasets.html">torchaudio.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../models.html">torchaudio.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../models.decoder.html">torchaudio.models.decoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pipelines.html">torchaudio.pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sox_effects.html">torchaudio.sox_effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../compliance.kaldi.html">torchaudio.compliance.kaldi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kaldi_io.html">torchaudio.kaldi_io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../utils.html">torchaudio.utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Prototype API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../prototype.html">torchaudio.prototype</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../prototype.functional.html">torchaudio.prototype.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../prototype.models.html">torchaudio.prototype.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../prototype.pipelines.html">torchaudio.prototype.pipelines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials.io.html">Media IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/audio_resampling_tutorial.html">Audio Resampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/audio_data_augmentation_tutorial.html">Audio Data Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/audio_feature_extractions_tutorial.html">Audio Feature Extractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/audio_feature_augmentation_tutorial.html">Audio Feature Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/audio_datasets_tutorial.html">Audio Datasets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Usages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/speech_recognition_pipeline_tutorial.html">Speech Recognition with Wav2Vec2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/online_asr_tutorial.html">Online ASR with Emformer RNN-T</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/device_asr.html">Device ASR with Emformer RNN-T</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/forced_alignment_tutorial.html">Forced Alignment with Wav2Vec2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/tacotron2_pipeline_tutorial.html">Text-to-Speech with Tacotron2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/mvdr_tutorial.html">Speech Enhancement with MVDR Beamforming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/asr_inference_with_ctc_decoder_tutorial.html">ASR Inference with CTC Decoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/hybrid_demucs_tutorial.html">Music Source Separation with Hybrid Demucs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PyTorch Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/docs">PyTorch</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/audio">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/text">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/vision">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/elastic/">TorchElastic</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pytorch.org/xla/">PyTorch on XLA Devices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../../../../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="../../../index.html">Module code</a> &gt;</li>
        
      <li>torchaudio.models.wav2vec2.model</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
    
    
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <h1>Source code for torchaudio.models.wav2vec2.model</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">Tensor</span>
<span class="kn">from</span> <span class="nn">torch.nn</span> <span class="kn">import</span> <span class="n">Module</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">components</span>


<div class="viewcode-block" id="Wav2Vec2Model"><a class="viewcode-back" href="../../../../generated/torchaudio.models.Wav2Vec2Model.html#torchaudio.models.Wav2Vec2Model">[docs]</a><span class="k">class</span> <span class="nc">Wav2Vec2Model</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Acoustic model used in *wav2vec 2.0* :cite:`baevski2020wav2vec`.</span>

<span class="sd">    Note:</span>
<span class="sd">        To build the model, please use one of the factory functions.</span>
<span class="sd">        :py:func:`wav2vec2_model`, :py:func:`wav2vec2_base`, :py:func:`wav2vec2_large`,</span>
<span class="sd">        :py:func:`wav2vec2_large_lv60k`, :py:func:`hubert_base`, :py:func:`hubert_large`,</span>
<span class="sd">        and :py:func:`hubert_xlarge`.</span>

<span class="sd">    See Also:</span>
<span class="sd">        * :class:`torchaudio.pipelines.Wav2Vec2Bundle`: Pretrained models (without fine-tuning)</span>
<span class="sd">        * :class:`torchaudio.pipelines.Wav2Vec2ASRBundle`: ASR pipelines with pretrained models.</span>

<span class="sd">    Args:</span>
<span class="sd">        feature_extractor (torch.nn.Module):</span>
<span class="sd">            Feature extractor that extracts feature vectors from raw audio Tensor.</span>

<span class="sd">        encoder (torch.nn.Module):</span>
<span class="sd">            Encoder that converts the audio features into the sequence of probability</span>
<span class="sd">            distribution (in negative log-likelihood) over labels.</span>

<span class="sd">        aux (torch.nn.Module or None, optional):</span>
<span class="sd">            Auxiliary module. If provided, the output from encoder is passed to this module.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature_extractor</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span>
        <span class="n">encoder</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span>
        <span class="n">aux</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span> <span class="o">=</span> <span class="n">feature_extractor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">encoder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux</span> <span class="o">=</span> <span class="n">aux</span>

<div class="viewcode-block" id="Wav2Vec2Model.extract_features"><a class="viewcode-back" href="../../../../generated/torchaudio.models.Wav2Vec2Model.html#torchaudio.models.Wav2Vec2Model.extract_features">[docs]</a>    <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">export</span>
    <span class="k">def</span> <span class="nf">extract_features</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">waveforms</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">lengths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_layers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Extract feature vectors from raw waveforms</span>

<span class="sd">        This returns the list of outputs from the intermediate layers of</span>
<span class="sd">        transformer block in encoder.</span>

<span class="sd">        Args:</span>
<span class="sd">            waveforms (Tensor): Audio tensor of shape `(batch, frames)`.</span>
<span class="sd">            lengths (Tensor or None, optional):</span>
<span class="sd">                Indicates the valid length of each audio in the batch.</span>
<span class="sd">                Shape: `(batch, )`.</span>
<span class="sd">                When the ``waveforms`` contains audios with different durations,</span>
<span class="sd">                by providing ``lengths`` argument, the model will compute</span>
<span class="sd">                the corresponding valid output lengths and apply proper mask in</span>
<span class="sd">                transformer attention layer.</span>
<span class="sd">                If ``None``, it is assumed that the entire audio waveform</span>
<span class="sd">                length is valid.</span>
<span class="sd">            num_layers (int or None, optional):</span>
<span class="sd">                If given, limit the number of intermediate layers to go through.</span>
<span class="sd">                Providing `1` will stop the computation after going through one</span>
<span class="sd">                intermediate layers. If not given, the outputs from all the</span>
<span class="sd">                intermediate layers are returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (List[Tensor], Optional[Tensor]):</span>
<span class="sd">            List of Tensors</span>
<span class="sd">                Features from requested layers.</span>
<span class="sd">                Each Tensor is of shape: `(batch, time frame, feature dimension)`</span>
<span class="sd">            Tensor or None</span>
<span class="sd">                If ``lengths`` argument was provided, a Tensor of shape `(batch, )`</span>
<span class="sd">                is returned.</span>
<span class="sd">                It indicates the valid length in time axis of each feature Tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">lengths</span></div>

<div class="viewcode-block" id="Wav2Vec2Model.forward"><a class="viewcode-back" href="../../../../generated/torchaudio.models.Wav2Vec2Model.html#torchaudio.models.Wav2Vec2Model.forward">[docs]</a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">waveforms</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">lengths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Compute the sequence of probability distribution over labels.</span>

<span class="sd">        Args:</span>
<span class="sd">            waveforms (Tensor): Audio tensor of shape `(batch, frames)`.</span>
<span class="sd">            lengths (Tensor or None, optional):</span>
<span class="sd">                Indicates the valid length of each audio in the batch.</span>
<span class="sd">                Shape: `(batch, )`.</span>
<span class="sd">                When the ``waveforms`` contains audios with different durations,</span>
<span class="sd">                by providing ``lengths`` argument, the model will compute</span>
<span class="sd">                the corresponding valid output lengths and apply proper mask in</span>
<span class="sd">                transformer attention layer.</span>
<span class="sd">                If ``None``, it is assumed that all the audio in ``waveforms``</span>
<span class="sd">                have valid length. Default: ``None``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Tensor, Optional[Tensor]):</span>
<span class="sd">            Tensor</span>
<span class="sd">                The sequences of probability distribution (in logit) over labels.</span>
<span class="sd">                Shape: `(batch, frames, num labels)`.</span>
<span class="sd">            Tensor or None</span>
<span class="sd">                If ``lengths`` argument was provided, a Tensor of shape `(batch, )`</span>
<span class="sd">                is returned.</span>
<span class="sd">                It indicates the valid length in time axis of the output Tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aux</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">lengths</span></div></div>


<div class="viewcode-block" id="HuBERTPretrainModel"><a class="viewcode-back" href="../../../../generated/torchaudio.models.HuBERTPretrainModel.html#torchaudio.models.HuBERTPretrainModel">[docs]</a><span class="k">class</span> <span class="nc">HuBERTPretrainModel</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;HuBERTPretrainModel()</span>

<span class="sd">    HuBERT model used for pretraining in *HuBERT* :cite:`hsu2021hubert`.</span>

<span class="sd">    Note:</span>
<span class="sd">        To build the model, please use one of the factory functions,</span>
<span class="sd">        :py:func:`hubert_pretrain_base`, :py:func:`hubert_pretrain_large`</span>
<span class="sd">        or :py:func:`hubert_pretrain_xlarge`.</span>

<span class="sd">    See Also:</span>
<span class="sd">        `HuBERT Pre-training and Fine-tuning Examples</span>
<span class="sd">        &lt;https://github.com/pytorch/audio/tree/release/0.12/examples/hubert&gt;`__</span>

<span class="sd">    Args:</span>
<span class="sd">        wav2vec2 (Wav2Vec2Model):</span>
<span class="sd">            Wav2Vec2 encoder that generates the transformer outputs.</span>

<span class="sd">        mask_generator (torch.nn.Module):</span>
<span class="sd">            Mask generator that generates the mask for masked prediction during the training.</span>

<span class="sd">        logit_generator (torch.nn.Module):</span>
<span class="sd">            Logit generator that predicts the logits of the masked and unmasked inputs.</span>

<span class="sd">        feature_grad_mult (float or None):</span>
<span class="sd">            The factor to scale the convolutional feature extraction layer gradients by.</span>
<span class="sd">            If ``None``, the gradients of feature extraction layers are not affected.</span>
<span class="sd">            The scale factor will not affect the forward pass.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">wav2vec2</span><span class="p">:</span> <span class="n">Wav2Vec2Model</span><span class="p">,</span>
        <span class="n">mask_generator</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span>
        <span class="n">logit_generator</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span>
        <span class="n">feature_grad_mult</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wav2vec2</span> <span class="o">=</span> <span class="n">wav2vec2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_generator</span> <span class="o">=</span> <span class="n">mask_generator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logit_generator</span> <span class="o">=</span> <span class="n">logit_generator</span>
        <span class="k">if</span> <span class="n">feature_grad_mult</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">feature_grad_mult</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The value of `feature_grad_mult` must be ``None``or between (0, 1). Found </span><span class="si">{</span><span class="n">feature_grad_mult</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_grad_mult</span> <span class="o">=</span> <span class="n">feature_grad_mult</span>

<div class="viewcode-block" id="HuBERTPretrainModel.forward"><a class="viewcode-back" href="../../../../generated/torchaudio.models.HuBERTPretrainModel.html#torchaudio.models.HuBERTPretrainModel.forward">[docs]</a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">waveforms</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">audio_lengths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Compute the sequence of probability distribution over labels.</span>

<span class="sd">        Args:</span>
<span class="sd">            waveforms (Tensor): Audio tensor of dimension `[batch, frames]`.</span>
<span class="sd">            labels (Tensor): Label for pre-training. A Tensor of dimension `[batch, frames]`.</span>
<span class="sd">            audio_lengths (Tensor or None, optional):</span>
<span class="sd">                Indicates the valid length of each audio in the batch.</span>
<span class="sd">                Shape: `[batch, ]`.</span>
<span class="sd">                When the ``waveforms`` contains audios with different durations,</span>
<span class="sd">                by providing ``lengths`` argument, the model will compute</span>
<span class="sd">                the corresponding valid output lengths and apply proper mask in</span>
<span class="sd">                transformer attention layer.</span>
<span class="sd">                If ``None``, it is assumed that all the audio in ``waveforms``</span>
<span class="sd">                have valid length. Default: ``None``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Tensor, Tensor, Tensor):</span>
<span class="sd">            Tensor</span>
<span class="sd">                The masked sequences of probability distribution (in logit).</span>
<span class="sd">                Shape: `(masked_frames, num labels)`.</span>
<span class="sd">            Tensor</span>
<span class="sd">                The unmasked sequence of probability distribution (in logit).</span>
<span class="sd">                Shape: `(unmasked_frames, num labels)`.</span>
<span class="sd">            Tensor</span>
<span class="sd">                The feature mean value for additional penalty loss.</span>
<span class="sd">                Shape: `(1,)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wav2vec2</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">audio_lengths</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_grad_mult</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_grad_mult</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">GradMultiply</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_grad_mult</span><span class="p">)</span>
        <span class="n">features_pen</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lengths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">padding_mask</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">_get_padding_mask</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">padding_mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">attention_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wav2vec2</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_generator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">padding_mask</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wav2vec2</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">transformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The length of label must match that of HuBERT model output&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">padding_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask_m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="o">~</span><span class="n">padding_mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
            <span class="n">mask_u</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="o">~</span><span class="n">padding_mask</span><span class="p">,</span> <span class="o">~</span><span class="n">mask_m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask_m</span> <span class="o">=</span> <span class="n">mask</span>
            <span class="n">mask_u</span> <span class="o">=</span> <span class="o">~</span><span class="n">mask_m</span>

        <span class="n">logit_m</span><span class="p">,</span> <span class="n">logit_u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logit_generator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">mask_m</span><span class="p">,</span> <span class="n">mask_u</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">logit_m</span><span class="p">,</span> <span class="n">logit_u</span><span class="p">,</span> <span class="n">features_pen</span></div></div>


<div class="viewcode-block" id="wav2vec2_model"><a class="viewcode-back" href="../../../../generated/torchaudio.models.wav2vec2_model.html#torchaudio.models.wav2vec2_model">[docs]</a><span class="k">def</span> <span class="nf">wav2vec2_model</span><span class="p">(</span>
    <span class="n">extractor_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">extractor_conv_layer_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span>
    <span class="n">extractor_conv_bias</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">encoder_embed_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">encoder_projection_dropout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">encoder_pos_conv_kernel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">encoder_pos_conv_groups</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">encoder_num_layers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">encoder_num_heads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">encoder_attention_dropout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_dropout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">encoder_dropout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">encoder_layer_norm_first</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">encoder_layer_drop</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">aux_num_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Wav2Vec2Model</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Builds custom :class:`~torchaudio.models.Wav2Vec2Model`.</span>

<span class="sd">    Note:</span>
<span class="sd">        The &quot;feature extractor&quot; below corresponds to</span>
<span class="sd">        `ConvFeatureExtractionModel &lt;https://github.com/pytorch/fairseq/blob/dd3bd3c0497ae9a7ae7364404a6b0a4c501780b3/fairseq/models/wav2vec/wav2vec2.py#L736&gt;`__</span>
<span class="sd">        in the original ``fairseq`` implementation.</span>
<span class="sd">        This is referred as &quot;(convolutional) feature encoder&quot; in the *wav2vec 2.0*</span>
<span class="sd">        :cite:`baevski2020wav2vec` paper.</span>

<span class="sd">        The &quot;encoder&quot; below corresponds to `TransformerEncoder &lt;https://github.com/pytorch/fairseq/blob/dd3bd3c0497ae9a7ae7364404a6b0a4c501780b3/fairseq/models/wav2vec/wav2vec2.py#L817&gt;`__,</span>
<span class="sd">        and this is referred as &quot;Transformer&quot; in the paper.</span>

<span class="sd">    Args:</span>
<span class="sd">        extractor_mode (str): Operation mode of feature extractor.</span>
<span class="sd">            Valid values are ``&quot;group_norm&quot;`` or ``&quot;layer_norm&quot;``.</span>
<span class="sd">            If ``&quot;group_norm&quot;``, then a single normalization is applied</span>
<span class="sd">            in the first convolution block. Otherwise, all the convolution</span>
<span class="sd">            blocks will have layer normalization.</span>

<span class="sd">            This option corresponds to ``extractor_mode`` from ``fairseq``.</span>
<span class="sd">        extractor_conv_layer_config (list of integer tuples or None):</span>
<span class="sd">            Configuration of convolution layers in feature extractor.</span>
<span class="sd">            List of convolution configuration,</span>
<span class="sd">            i.e. ``[(output_channel, kernel_size, stride), ...]``</span>

<span class="sd">            If ``None`` is provided, then the following default value is used.</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">               [</span>
<span class="sd">                 (512, 10, 5),</span>
<span class="sd">                 (512, 3, 2),</span>
<span class="sd">                 (512, 3, 2),</span>
<span class="sd">                 (512, 3, 2),</span>
<span class="sd">                 (512, 3, 2),</span>
<span class="sd">                 (512, 2, 2),</span>
<span class="sd">                 (512, 2, 2),</span>
<span class="sd">               ]</span>

<span class="sd">            This option corresponds to ``conv_feature_layers`` from ``fairseq``.</span>

<span class="sd">        extractor_conv_bias (bool):</span>
<span class="sd">            Whether to include bias term to each convolution operation.</span>

<span class="sd">            This option corresponds to ``conv_bias`` from ``fairseq``.</span>

<span class="sd">        encoder_embed_dim (int):</span>
<span class="sd">            The dimension of embedding in encoder.</span>

<span class="sd">            This option corresponds to ``encoder_embed_dim`` from ``fairseq``.</span>

<span class="sd">        encoder_projection_dropout (float):</span>
<span class="sd">            The dropout probability applied after the input feature is projected</span>
<span class="sd">            to ``encoder_embed_dim``.</span>

<span class="sd">            This option corresponds to ``dropout_input`` from ``fairseq``.</span>

<span class="sd">        encoder_pos_conv_kernel (int):</span>
<span class="sd">            The kernel size of convolutional positional embeddings.</span>

<span class="sd">            This option corresponds to ``conv_pos`` from ``fairseq``.</span>

<span class="sd">        encoder_pos_conv_groups (int):</span>
<span class="sd">            The number of groups of convolutional positional embeddings.</span>

<span class="sd">            This option corresponds to ``conv_pos_groups`` from ``fairseq``.</span>

<span class="sd">        encoder_num_layers (int):</span>
<span class="sd">            The number of self attention layers in transformer block.</span>

<span class="sd">            This option corresponds to ``encoder_layers`` from ``fairseq``.</span>

<span class="sd">        encoder_num_heads (int):</span>
<span class="sd">            The number of heads in self attention layers.</span>

<span class="sd">            This option corresponds to ``encoder_attention_heads`` from ``fairseq``.</span>

<span class="sd">        encoder_attention_dropout (float):</span>
<span class="sd">            The dropout probability applied after softmax in self-attention layer.</span>

<span class="sd">            This option corresponds to ``attention_dropout`` from ``fairseq``.</span>

<span class="sd">        encoder_ff_interm_features (int):</span>
<span class="sd">            The dimension of hidden features in feed forward layer.</span>

<span class="sd">            This option corresponds to ``encoder_ffn_embed_dim`` from ``fairseq``.</span>

<span class="sd">        encoder_ff_interm_dropout (float):</span>
<span class="sd">            The dropout probability applied in feedforward layer.</span>

<span class="sd">            This option correspinds to ``activation_dropout`` from ``fairseq``.</span>

<span class="sd">        encoder_dropout (float):</span>
<span class="sd">            The dropout probability applied at the end of feed forward layer.</span>

<span class="sd">            This option corresponds to ``dropout`` from ``fairseq``.</span>

<span class="sd">        encoder_layer_norm_first (bool):</span>
<span class="sd">            Control the order of layer norm in transformer layer and each encoder layer.</span>
<span class="sd">            If True, in transformer layer, layer norm is applied before features are fed</span>
<span class="sd">            to encoder layers. In encoder layer, two layer norms are applied before and after</span>
<span class="sd">            self attention.</span>
<span class="sd">            If False, in transformer layer, layer norm is applied after features are fed</span>
<span class="sd">            to encoder layers. In encoder layer, two layer norms are applied after self</span>
<span class="sd">            attention, before and after feed forward.</span>

<span class="sd">            This option corresponds to ``layer_norm_first`` from ``fairseq``.</span>

<span class="sd">        encoder_layer_drop (float):</span>
<span class="sd">            Probability to drop each encoder layer during training.</span>

<span class="sd">            This option corresponds to ``layerdrop`` from ``fairseq``.</span>

<span class="sd">        aux_num_out (int or None):</span>
<span class="sd">            When provided, attach an extra linear layer on top of encoder, which can be</span>
<span class="sd">            used for fine-tuning.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Wav2Vec2Model:</span>
<span class="sd">            The resulting model.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="k">if</span> <span class="n">extractor_conv_layer_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">extractor_conv_layer_config</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="p">[(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="n">feature_extractor</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">_get_feature_extractor</span><span class="p">(</span>
        <span class="n">extractor_mode</span><span class="p">,</span> <span class="n">extractor_conv_layer_config</span><span class="p">,</span> <span class="n">extractor_conv_bias</span>
    <span class="p">)</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">_get_encoder</span><span class="p">(</span>
        <span class="n">in_features</span><span class="o">=</span><span class="n">extractor_conv_layer_config</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">embed_dim</span><span class="o">=</span><span class="n">encoder_embed_dim</span><span class="p">,</span>
        <span class="n">dropout_input</span><span class="o">=</span><span class="n">encoder_projection_dropout</span><span class="p">,</span>
        <span class="n">pos_conv_kernel</span><span class="o">=</span><span class="n">encoder_pos_conv_kernel</span><span class="p">,</span>
        <span class="n">pos_conv_groups</span><span class="o">=</span><span class="n">encoder_pos_conv_groups</span><span class="p">,</span>
        <span class="n">num_layers</span><span class="o">=</span><span class="n">encoder_num_layers</span><span class="p">,</span>
        <span class="n">num_heads</span><span class="o">=</span><span class="n">encoder_num_heads</span><span class="p">,</span>
        <span class="n">attention_dropout</span><span class="o">=</span><span class="n">encoder_attention_dropout</span><span class="p">,</span>
        <span class="n">ff_interm_features</span><span class="o">=</span><span class="n">encoder_ff_interm_features</span><span class="p">,</span>
        <span class="n">ff_interm_dropout</span><span class="o">=</span><span class="n">encoder_ff_interm_dropout</span><span class="p">,</span>
        <span class="n">dropout</span><span class="o">=</span><span class="n">encoder_dropout</span><span class="p">,</span>
        <span class="n">layer_norm_first</span><span class="o">=</span><span class="n">encoder_layer_norm_first</span><span class="p">,</span>
        <span class="n">layer_drop</span><span class="o">=</span><span class="n">encoder_layer_drop</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">aux</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">aux_num_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="n">encoder_embed_dim</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="n">aux_num_out</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Wav2Vec2Model</span><span class="p">(</span><span class="n">feature_extractor</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">aux</span><span class="p">)</span></div>


<div class="viewcode-block" id="wav2vec2_base"><a class="viewcode-back" href="../../../../generated/torchaudio.models.wav2vec2_base.html#torchaudio.models.wav2vec2_base">[docs]</a><span class="k">def</span> <span class="nf">wav2vec2_base</span><span class="p">(</span>
    <span class="n">encoder_projection_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_attention_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_layer_drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">aux_num_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Wav2Vec2Model</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Builds &quot;base&quot; :class:`~torchaudio.models.Wav2Vec2Model` from *wav2vec 2.0* :cite:`baevski2020wav2vec`</span>

<span class="sd">    Args:</span>
<span class="sd">        encoder_projection_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_attention_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_ff_interm_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_layer_drop (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        aux_num_out (int or None, optional):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Wav2Vec2Model:</span>
<span class="sd">            The resulting model.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="k">return</span> <span class="n">wav2vec2_model</span><span class="p">(</span>
        <span class="n">extractor_mode</span><span class="o">=</span><span class="s2">&quot;group_norm&quot;</span><span class="p">,</span>
        <span class="n">extractor_conv_layer_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">extractor_conv_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder_embed_dim</span><span class="o">=</span><span class="mi">768</span><span class="p">,</span>
        <span class="n">encoder_projection_dropout</span><span class="o">=</span><span class="n">encoder_projection_dropout</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_kernel</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_groups</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_num_layers</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">encoder_num_heads</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">encoder_attention_dropout</span><span class="o">=</span><span class="n">encoder_attention_dropout</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_features</span><span class="o">=</span><span class="mi">3072</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_dropout</span><span class="o">=</span><span class="n">encoder_ff_interm_dropout</span><span class="p">,</span>
        <span class="n">encoder_dropout</span><span class="o">=</span><span class="n">encoder_dropout</span><span class="p">,</span>
        <span class="n">encoder_layer_norm_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder_layer_drop</span><span class="o">=</span><span class="n">encoder_layer_drop</span><span class="p">,</span>
        <span class="n">aux_num_out</span><span class="o">=</span><span class="n">aux_num_out</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="wav2vec2_large"><a class="viewcode-back" href="../../../../generated/torchaudio.models.wav2vec2_large.html#torchaudio.models.wav2vec2_large">[docs]</a><span class="k">def</span> <span class="nf">wav2vec2_large</span><span class="p">(</span>
    <span class="n">encoder_projection_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_attention_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_layer_drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">aux_num_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Wav2Vec2Model</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Builds &quot;large&quot; :class:`~torchaudio.models.Wav2Vec2Model` from *wav2vec 2.0* :cite:`baevski2020wav2vec`</span>

<span class="sd">    Args:</span>
<span class="sd">        encoder_projection_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_attention_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_ff_interm_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_layer_drop (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        aux_num_out (int or None, optional):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Wav2Vec2Model:</span>
<span class="sd">            The resulting model.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="k">return</span> <span class="n">wav2vec2_model</span><span class="p">(</span>
        <span class="n">extractor_mode</span><span class="o">=</span><span class="s2">&quot;group_norm&quot;</span><span class="p">,</span>
        <span class="n">extractor_conv_layer_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">extractor_conv_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder_embed_dim</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">encoder_projection_dropout</span><span class="o">=</span><span class="n">encoder_projection_dropout</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_kernel</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_groups</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_num_layers</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
        <span class="n">encoder_num_heads</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_attention_dropout</span><span class="o">=</span><span class="n">encoder_attention_dropout</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_features</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_dropout</span><span class="o">=</span><span class="n">encoder_ff_interm_dropout</span><span class="p">,</span>
        <span class="n">encoder_dropout</span><span class="o">=</span><span class="n">encoder_dropout</span><span class="p">,</span>
        <span class="n">encoder_layer_norm_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder_layer_drop</span><span class="o">=</span><span class="n">encoder_layer_drop</span><span class="p">,</span>
        <span class="n">aux_num_out</span><span class="o">=</span><span class="n">aux_num_out</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="wav2vec2_large_lv60k"><a class="viewcode-back" href="../../../../generated/torchaudio.models.wav2vec2_large_lv60k.html#torchaudio.models.wav2vec2_large_lv60k">[docs]</a><span class="k">def</span> <span class="nf">wav2vec2_large_lv60k</span><span class="p">(</span>
    <span class="n">encoder_projection_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_attention_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_layer_drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">aux_num_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Wav2Vec2Model</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Builds &quot;large lv-60k&quot; :class:`~torchaudio.models.Wav2Vec2Model` from *wav2vec 2.0* :cite:`baevski2020wav2vec`</span>

<span class="sd">    Args:</span>
<span class="sd">        encoder_projection_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_attention_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_ff_interm_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_layer_drop (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        aux_num_out (int or None, optional):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Wav2Vec2Model:</span>
<span class="sd">            The resulting model.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="k">return</span> <span class="n">wav2vec2_model</span><span class="p">(</span>
        <span class="n">extractor_mode</span><span class="o">=</span><span class="s2">&quot;layer_norm&quot;</span><span class="p">,</span>
        <span class="n">extractor_conv_layer_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">extractor_conv_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">encoder_embed_dim</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">encoder_projection_dropout</span><span class="o">=</span><span class="n">encoder_projection_dropout</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_kernel</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_groups</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_num_layers</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
        <span class="n">encoder_num_heads</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_attention_dropout</span><span class="o">=</span><span class="n">encoder_attention_dropout</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_features</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_dropout</span><span class="o">=</span><span class="n">encoder_ff_interm_dropout</span><span class="p">,</span>
        <span class="n">encoder_dropout</span><span class="o">=</span><span class="n">encoder_dropout</span><span class="p">,</span>
        <span class="n">encoder_layer_norm_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">encoder_layer_drop</span><span class="o">=</span><span class="n">encoder_layer_drop</span><span class="p">,</span>
        <span class="n">aux_num_out</span><span class="o">=</span><span class="n">aux_num_out</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="hubert_base"><a class="viewcode-back" href="../../../../generated/torchaudio.models.hubert_base.html#torchaudio.models.hubert_base">[docs]</a><span class="k">def</span> <span class="nf">hubert_base</span><span class="p">(</span>
    <span class="n">encoder_projection_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_attention_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_layer_drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">aux_num_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Wav2Vec2Model</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Builds &quot;base&quot; :class:`HuBERT &lt;torchaudio.models.Wav2Vec2Model&gt;` from *HuBERT* :cite:`hsu2021hubert`</span>

<span class="sd">    Args:</span>
<span class="sd">        encoder_projection_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_attention_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_ff_interm_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_layer_drop (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        aux_num_out (int or None, optional):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Wav2Vec2Model:</span>
<span class="sd">            The resulting model.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="k">return</span> <span class="n">wav2vec2_model</span><span class="p">(</span>
        <span class="n">extractor_mode</span><span class="o">=</span><span class="s2">&quot;group_norm&quot;</span><span class="p">,</span>
        <span class="n">extractor_conv_layer_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">extractor_conv_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder_embed_dim</span><span class="o">=</span><span class="mi">768</span><span class="p">,</span>
        <span class="n">encoder_projection_dropout</span><span class="o">=</span><span class="n">encoder_projection_dropout</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_kernel</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_groups</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_num_layers</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">encoder_num_heads</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">encoder_attention_dropout</span><span class="o">=</span><span class="n">encoder_attention_dropout</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_features</span><span class="o">=</span><span class="mi">3072</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_dropout</span><span class="o">=</span><span class="n">encoder_ff_interm_dropout</span><span class="p">,</span>
        <span class="n">encoder_dropout</span><span class="o">=</span><span class="n">encoder_dropout</span><span class="p">,</span>
        <span class="n">encoder_layer_norm_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder_layer_drop</span><span class="o">=</span><span class="n">encoder_layer_drop</span><span class="p">,</span>
        <span class="n">aux_num_out</span><span class="o">=</span><span class="n">aux_num_out</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="hubert_large"><a class="viewcode-back" href="../../../../generated/torchaudio.models.hubert_large.html#torchaudio.models.hubert_large">[docs]</a><span class="k">def</span> <span class="nf">hubert_large</span><span class="p">(</span>
    <span class="n">encoder_projection_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_attention_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_layer_drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">aux_num_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Wav2Vec2Model</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Builds &quot;large&quot; :class:`HuBERT &lt;torchaudio.models.Wav2Vec2Model&gt;` from *HuBERT* :cite:`hsu2021hubert`</span>

<span class="sd">    Args:</span>
<span class="sd">        encoder_projection_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_attention_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_ff_interm_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_layer_drop (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        aux_num_out (int or None, optional):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Wav2Vec2Model:</span>
<span class="sd">            The resulting model.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="k">return</span> <span class="n">wav2vec2_model</span><span class="p">(</span>
        <span class="n">extractor_mode</span><span class="o">=</span><span class="s2">&quot;layer_norm&quot;</span><span class="p">,</span>
        <span class="n">extractor_conv_layer_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">extractor_conv_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder_embed_dim</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">encoder_projection_dropout</span><span class="o">=</span><span class="n">encoder_projection_dropout</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_kernel</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_groups</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_num_layers</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
        <span class="n">encoder_num_heads</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_attention_dropout</span><span class="o">=</span><span class="n">encoder_attention_dropout</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_features</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_dropout</span><span class="o">=</span><span class="n">encoder_ff_interm_dropout</span><span class="p">,</span>
        <span class="n">encoder_dropout</span><span class="o">=</span><span class="n">encoder_dropout</span><span class="p">,</span>
        <span class="n">encoder_layer_norm_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">encoder_layer_drop</span><span class="o">=</span><span class="n">encoder_layer_drop</span><span class="p">,</span>
        <span class="n">aux_num_out</span><span class="o">=</span><span class="n">aux_num_out</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="hubert_xlarge"><a class="viewcode-back" href="../../../../generated/torchaudio.models.hubert_xlarge.html#torchaudio.models.hubert_xlarge">[docs]</a><span class="k">def</span> <span class="nf">hubert_xlarge</span><span class="p">(</span>
    <span class="n">encoder_projection_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_attention_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_layer_drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">aux_num_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Wav2Vec2Model</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Builds &quot;extra large&quot; :class:`HuBERT &lt;torchaudio.models.Wav2Vec2Model&gt;` from *HuBERT* :cite:`hsu2021hubert`</span>

<span class="sd">    Args:</span>
<span class="sd">        encoder_projection_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_attention_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_ff_interm_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_dropout (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        encoder_layer_drop (float):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>
<span class="sd">        aux_num_out (int or None, optional):</span>
<span class="sd">            See :py:func:`wav2vec2_model`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Wav2Vec2Model:</span>
<span class="sd">            The resulting model.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="k">return</span> <span class="n">wav2vec2_model</span><span class="p">(</span>
        <span class="n">extractor_mode</span><span class="o">=</span><span class="s2">&quot;layer_norm&quot;</span><span class="p">,</span>
        <span class="n">extractor_conv_layer_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">extractor_conv_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder_embed_dim</span><span class="o">=</span><span class="mi">1280</span><span class="p">,</span>
        <span class="n">encoder_projection_dropout</span><span class="o">=</span><span class="n">encoder_projection_dropout</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_kernel</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_groups</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_num_layers</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span>
        <span class="n">encoder_num_heads</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_attention_dropout</span><span class="o">=</span><span class="n">encoder_attention_dropout</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_features</span><span class="o">=</span><span class="mi">5120</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_dropout</span><span class="o">=</span><span class="n">encoder_ff_interm_dropout</span><span class="p">,</span>
        <span class="n">encoder_dropout</span><span class="o">=</span><span class="n">encoder_dropout</span><span class="p">,</span>
        <span class="n">encoder_layer_norm_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">encoder_layer_drop</span><span class="o">=</span><span class="n">encoder_layer_drop</span><span class="p">,</span>
        <span class="n">aux_num_out</span><span class="o">=</span><span class="n">aux_num_out</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_init_hubert_pretrain_model</span><span class="p">(</span><span class="n">module</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">components</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">):</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">kaiming_normal_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">components</span><span class="o">.</span><span class="n">ConvolutionalPositionalEmbedding</span><span class="p">):</span>
        <span class="c1"># normalize the weight to normal distribution.</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">embed_dim</span> <span class="o">*</span> <span class="n">module</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">))</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">normal_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="n">std</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">components</span><span class="o">.</span><span class="n">SelfAttention</span><span class="p">):</span>
        <span class="c1"># normalize the query, key, value, and out_proj parameters in self attention module.</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">xavier_uniform_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">k_proj</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">xavier_uniform_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">v_proj</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">xavier_uniform_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">q_proj</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">xavier_uniform_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">out_proj</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">out_proj</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">components</span><span class="o">.</span><span class="n">Transformer</span><span class="p">):</span>
        <span class="n">module</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">components</span><span class="o">.</span><span class="n">_init_transformer_params</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>


<div class="viewcode-block" id="hubert_pretrain_model"><a class="viewcode-back" href="../../../../generated/torchaudio.models.hubert_pretrain_model.html#torchaudio.models.hubert_pretrain_model">[docs]</a><span class="k">def</span> <span class="nf">hubert_pretrain_model</span><span class="p">(</span>
    <span class="n">extractor_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">extractor_conv_layer_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span>
    <span class="n">extractor_conv_bias</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">encoder_embed_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">encoder_projection_dropout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">encoder_pos_conv_kernel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">encoder_pos_conv_groups</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">encoder_num_layers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">encoder_num_heads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">encoder_attention_dropout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_dropout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">encoder_dropout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">encoder_layer_norm_first</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">encoder_layer_drop</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">mask_prob</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">mask_selection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">mask_other</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">mask_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">no_mask_overlap</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">mask_min_space</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">mask_channel_prob</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">mask_channel_selection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">mask_channel_other</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">mask_channel_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">no_mask_channel_overlap</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">mask_channel_min_space</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">skip_masked</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">skip_nomask</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">final_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">feature_grad_mult</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HuBERTPretrainModel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Builds custom :class:`HuBERTPretrainModel` for training from scratch</span>

<span class="sd">    Note:</span>
<span class="sd">        The &quot;feature extractor&quot; below corresponds to</span>
<span class="sd">        `ConvFeatureExtractionModel &lt;https://github.com/pytorch/fairseq/blob/dd3bd3c0497ae9a7ae7364404a6b0a4c501780b3/fairseq/models/wav2vec/wav2vec2.py#L736&gt;`__</span>
<span class="sd">        in the original ``fairseq`` implementation.</span>
<span class="sd">        This is referred as &quot;(convolutional) feature encoder&quot; in the *wav2vec 2.0*</span>
<span class="sd">        :cite:`baevski2020wav2vec` paper.</span>

<span class="sd">        The &quot;encoder&quot; below corresponds to `TransformerEncoder &lt;https://github.com/pytorch/fairseq/blob/dd3bd3c0497ae9a7ae7364404a6b0a4c501780b3/fairseq/models/wav2vec/wav2vec2.py#L817&gt;`__,</span>
<span class="sd">        and this is referred as &quot;Transformer&quot; in the paper.</span>

<span class="sd">    Args:</span>
<span class="sd">        extractor_mode (str): Operation mode of feature extractor.</span>
<span class="sd">            Valid values are ``&quot;group_norm&quot;`` or ``&quot;layer_norm&quot;``.</span>
<span class="sd">            If ``&quot;group_norm&quot;``, then a single normalization is applied</span>
<span class="sd">            in the first convolution block. Otherwise, all the convolution</span>
<span class="sd">            blocks will have layer normalization.</span>

<span class="sd">            This option corresponds to ``extractor_mode`` from ``fairseq``.</span>

<span class="sd">        extractor_conv_layer_config (list of integer tuples or None):</span>
<span class="sd">            Configuration of convolution layers in feature extractor.</span>
<span class="sd">            List of convolution configuration,</span>
<span class="sd">            i.e. ``[(output_channel, kernel_size, stride), ...]``</span>

<span class="sd">            If ``None`` is provided, then the following default value is used.</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">               [</span>
<span class="sd">                 (512, 10, 5),</span>
<span class="sd">                 (512, 3, 2),</span>
<span class="sd">                 (512, 3, 2),</span>
<span class="sd">                 (512, 3, 2),</span>
<span class="sd">                 (512, 3, 2),</span>
<span class="sd">                 (512, 2, 2),</span>
<span class="sd">                 (512, 2, 2),</span>
<span class="sd">               ]</span>

<span class="sd">            This option corresponds to ``conv_feature_layers`` from ``fairseq``.</span>

<span class="sd">        extractor_conv_bias (bool):</span>
<span class="sd">            Whether to include bias term to each convolution operation.</span>

<span class="sd">            This option corresponds to ``conv_bias`` from ``fairseq``.</span>

<span class="sd">        encoder_embed_dim (int):</span>
<span class="sd">            The dimension of embedding in encoder.</span>

<span class="sd">            This option corresponds to ``encoder_embed_dim`` from ``fairseq``.</span>

<span class="sd">        encoder_projection_dropout (float):</span>
<span class="sd">            The dropout probability applied after the input feature is projected</span>
<span class="sd">            to ``encoder_embed_dim``.</span>

<span class="sd">            This option corresponds to ``dropout_input`` from ``fairseq``.</span>

<span class="sd">        encoder_pos_conv_kernel (int):</span>
<span class="sd">            The kernel size of convolutional positional embeddings.</span>

<span class="sd">            This option corresponds to ``conv_pos`` from ``fairseq``.</span>

<span class="sd">        encoder_pos_conv_groups (int):</span>
<span class="sd">            The number of groups of convolutional positional embeddings.</span>

<span class="sd">            This option corresponds to ``conv_pos_groups`` from ``fairseq``.</span>

<span class="sd">        encoder_num_layers (int):</span>
<span class="sd">            The number of self attention layers in transformer block.</span>

<span class="sd">            This option corresponds to ``encoder_layers`` from ``fairseq``.</span>

<span class="sd">        encoder_num_heads (int):</span>
<span class="sd">            The number of heads in self attention layers.</span>

<span class="sd">            This option corresponds to ``encoder_attention_heads`` from ``fairseq``.</span>

<span class="sd">        encoder_attention_dropout (float):</span>
<span class="sd">            The dropout probability applied after softmax in self-attention layer.</span>

<span class="sd">            This option corresponds to ``attention_dropout`` from ``fairseq``.</span>

<span class="sd">        encoder_ff_interm_features (int):</span>
<span class="sd">            The dimension of hidden features in feed forward layer.</span>

<span class="sd">            This option corresponds to ``encoder_ffn_embed_dim`` from ``fairseq``.</span>

<span class="sd">        encoder_ff_interm_dropout (float):</span>
<span class="sd">            The dropout probability applied in feedforward layer.</span>

<span class="sd">            This option correspinds to ``activation_dropout`` from ``fairseq``.</span>

<span class="sd">        encoder_dropout (float):</span>
<span class="sd">            The dropout probability applied at the end of feed forward layer.</span>

<span class="sd">            This option corresponds to ``dropout`` from ``fairseq``.</span>

<span class="sd">        encoder_layer_norm_first (bool):</span>
<span class="sd">            Control the order of layer norm in transformer layer and each encoder layer.</span>
<span class="sd">            If True, in transformer layer, layer norm is applied before features are fed</span>
<span class="sd">            to encoder layers. In encoder layer, two layer norms are applied before and after</span>
<span class="sd">            self attention.</span>
<span class="sd">            If False, in transformer layer, layer norm is applied after features are fed</span>
<span class="sd">            to encoder layers. In encoder layer, two layer norms are applied after self</span>
<span class="sd">            attention, before and after feed forward.</span>

<span class="sd">            This option corresponds to ``layer_norm_first`` from ``fairseq``.</span>

<span class="sd">        encoder_layer_drop (float):</span>
<span class="sd">            Probability to drop each encoder layer during training.</span>

<span class="sd">            This option corresponds to ``layerdrop`` from ``fairseq``.</span>

<span class="sd">        mask_prob (float):</span>
<span class="sd">            Probability for each token to be chosen as start of the span to be masked. this will be multiplied by</span>
<span class="sd">            number of timesteps divided by length of mask span to mask approximately this percentage of all elements.</span>
<span class="sd">            However due to overlaps, the actual number will be smaller (unless no_overlap is True).</span>

<span class="sd">            This option corresponds to ``mask_prob`` from ``fairseq``.</span>

<span class="sd">        mask_selection (str):</span>
<span class="sd">            How to choose the mask length. Options: [``static``, ``uniform``, ``normal``, ``poisson``].</span>

<span class="sd">            This option corresponds to ``mask_selection`` from ``fairseq``.</span>

<span class="sd">        mask_other (float):</span>
<span class="sd">            Secondary mask argument (used for more complex distributions).</span>

<span class="sd">            This option corresponds to ``mask_other`` from ``fairseq``.</span>

<span class="sd">        mask_length (int):</span>
<span class="sd">            The lengths of the mask.</span>

<span class="sd">            This option corresponds to ``mask_length`` from ``fairseq``.</span>

<span class="sd">        no_mask_overlap (bool):</span>
<span class="sd">            Whether to allow masks to overlap.</span>

<span class="sd">            This option corresponds to ``no_mask_overlap`` from ``fairseq``.</span>

<span class="sd">        mask_min_space (int):</span>
<span class="sd">            Minimum space between spans (if no overlap is enabled).</span>

<span class="sd">            This option corresponds to ``mask_min_space`` from ``fairseq``.</span>

<span class="sd">        mask_channel_prob: (float):</span>
<span class="sd">            The probability of replacing a feature with 0.</span>

<span class="sd">            This option corresponds to ``mask_channel_prob`` from ``fairseq``.</span>

<span class="sd">        mask_channel_selection (str):</span>
<span class="sd">            How to choose the mask length for channel masking. Options: [``static``, ``uniform``, ``normal``, ``poisson``].</span>

<span class="sd">            This option corresponds to ``mask_channel_selection`` from ``fairseq``.</span>

<span class="sd">        mask_channel_other (float):</span>
<span class="sd">            Secondary mask argument for channel masking(used for more complex distributions).</span>

<span class="sd">            This option corresponds to ``mask_channel_other`` from ``fairseq``.</span>

<span class="sd">        mask_channel_length (int):</span>
<span class="sd">            Minimum space between spans (if no overlap is enabled) for channel masking.</span>

<span class="sd">            This option corresponds to ``mask_channel_length`` from ``fairseq``.</span>

<span class="sd">        no_mask_channel_overlap (bool):</span>
<span class="sd">            Whether to allow channel masks to overlap.</span>

<span class="sd">            This option corresponds to ``no_mask_channel_overlap`` from ``fairseq``.</span>

<span class="sd">        mask_channel_min_space (int):</span>
<span class="sd">            Minimum space between spans for channel masking(if no overlap is enabled).</span>

<span class="sd">            This option corresponds to ``mask_channel_min_space`` from ``fairseq``.</span>

<span class="sd">        skip_masked (bool):</span>
<span class="sd">            If True, skip computing losses over masked frames.</span>

<span class="sd">            This option corresponds to ``skip_masked`` from ``fairseq``.</span>

<span class="sd">        skip_nomask (bool):</span>
<span class="sd">            If True, skip computing losses over unmasked frames.</span>

<span class="sd">            This option corresponds to ``skip_nomask`` from ``fairseq``.</span>

<span class="sd">        num_classes (int):</span>
<span class="sd">            The number of classes in the labels.</span>

<span class="sd">        final_dim (int):</span>
<span class="sd">            Project final representations and targets to `final_dim`.</span>

<span class="sd">            This option corresponds to ``final_dim`` from ``fairseq``.</span>

<span class="sd">        feature_grad_mult (float or None):</span>
<span class="sd">            The factor to scale the convolutional feature extraction layer gradients by.</span>
<span class="sd">            The scale factor will not affect the forward pass.</span>

<span class="sd">            This option corresponds to ``feature_grad_mult`` from ``fairseq``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        HuBERTPretrainModel:</span>
<span class="sd">            The resulting model.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="k">if</span> <span class="n">extractor_conv_layer_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">extractor_conv_layer_config</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="p">[(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="n">feature_extractor</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">_get_feature_extractor</span><span class="p">(</span>
        <span class="n">extractor_mode</span><span class="p">,</span> <span class="n">extractor_conv_layer_config</span><span class="p">,</span> <span class="n">extractor_conv_bias</span>
    <span class="p">)</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">_get_encoder</span><span class="p">(</span>
        <span class="n">in_features</span><span class="o">=</span><span class="n">extractor_conv_layer_config</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">embed_dim</span><span class="o">=</span><span class="n">encoder_embed_dim</span><span class="p">,</span>
        <span class="n">dropout_input</span><span class="o">=</span><span class="n">encoder_projection_dropout</span><span class="p">,</span>
        <span class="n">pos_conv_kernel</span><span class="o">=</span><span class="n">encoder_pos_conv_kernel</span><span class="p">,</span>
        <span class="n">pos_conv_groups</span><span class="o">=</span><span class="n">encoder_pos_conv_groups</span><span class="p">,</span>
        <span class="n">num_layers</span><span class="o">=</span><span class="n">encoder_num_layers</span><span class="p">,</span>
        <span class="n">num_heads</span><span class="o">=</span><span class="n">encoder_num_heads</span><span class="p">,</span>
        <span class="n">attention_dropout</span><span class="o">=</span><span class="n">encoder_attention_dropout</span><span class="p">,</span>
        <span class="n">ff_interm_features</span><span class="o">=</span><span class="n">encoder_ff_interm_features</span><span class="p">,</span>
        <span class="n">ff_interm_dropout</span><span class="o">=</span><span class="n">encoder_ff_interm_dropout</span><span class="p">,</span>
        <span class="n">dropout</span><span class="o">=</span><span class="n">encoder_dropout</span><span class="p">,</span>
        <span class="n">layer_norm_first</span><span class="o">=</span><span class="n">encoder_layer_norm_first</span><span class="p">,</span>
        <span class="n">layer_drop</span><span class="o">=</span><span class="n">encoder_layer_drop</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">wav2vec2</span> <span class="o">=</span> <span class="n">Wav2Vec2Model</span><span class="p">(</span><span class="n">feature_extractor</span><span class="p">,</span> <span class="n">encoder</span><span class="p">)</span>
    <span class="n">mask_generator</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">MaskGenerator</span><span class="p">(</span>
        <span class="n">encoder_embed_dim</span><span class="p">,</span>
        <span class="n">mask_prob</span><span class="p">,</span>
        <span class="n">mask_selection</span><span class="p">,</span>
        <span class="n">mask_other</span><span class="p">,</span>
        <span class="n">mask_length</span><span class="p">,</span>
        <span class="n">no_mask_overlap</span><span class="p">,</span>
        <span class="n">mask_min_space</span><span class="p">,</span>
        <span class="n">mask_channel_prob</span><span class="p">,</span>
        <span class="n">mask_channel_selection</span><span class="p">,</span>
        <span class="n">mask_channel_other</span><span class="p">,</span>
        <span class="n">mask_channel_length</span><span class="p">,</span>
        <span class="n">no_mask_channel_overlap</span><span class="p">,</span>
        <span class="n">mask_channel_min_space</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">logit_generator</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">LogitGenerator</span><span class="p">(</span>
        <span class="n">encoder_embed_dim</span><span class="p">,</span>
        <span class="n">num_classes</span><span class="p">,</span>
        <span class="n">final_dim</span><span class="p">,</span>
        <span class="n">skip_masked</span><span class="p">,</span>
        <span class="n">skip_nomask</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">HuBERTPretrainModel</span><span class="p">(</span>
        <span class="n">wav2vec2</span><span class="o">=</span><span class="n">wav2vec2</span><span class="p">,</span>
        <span class="n">mask_generator</span><span class="o">=</span><span class="n">mask_generator</span><span class="p">,</span>
        <span class="n">logit_generator</span><span class="o">=</span><span class="n">logit_generator</span><span class="p">,</span>
        <span class="n">feature_grad_mult</span><span class="o">=</span><span class="n">feature_grad_mult</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># initialize the model for pre-training</span>
    <span class="n">model</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">_init_hubert_pretrain_model</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span></div>


<div class="viewcode-block" id="hubert_pretrain_base"><a class="viewcode-back" href="../../../../generated/torchaudio.models.hubert_pretrain_base.html#torchaudio.models.hubert_pretrain_base">[docs]</a><span class="k">def</span> <span class="nf">hubert_pretrain_base</span><span class="p">(</span>
    <span class="n">encoder_projection_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_attention_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">encoder_layer_drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">mask_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">mask_channel_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">mask_channel_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">feature_grad_mult</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HuBERTPretrainModel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Builds &quot;base&quot; :class:`HuBERTPretrainModel` from *HuBERT* :cite:`hsu2021hubert` for pretraining.</span>

<span class="sd">    Args:</span>
<span class="sd">        encoder_projection_dropout (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        encoder_attention_dropout (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        encoder_ff_interm_dropout (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        encoder_dropout (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        encoder_layer_drop (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        mask_prob (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        mask_channel_prob (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        mask_channel_length (int):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        feature_grad_mult (float or None):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        num_classes (int, optional):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        HuBERTPretrainModel:</span>
<span class="sd">            The resulting model.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="k">return</span> <span class="n">hubert_pretrain_model</span><span class="p">(</span>
        <span class="n">extractor_mode</span><span class="o">=</span><span class="s2">&quot;group_norm&quot;</span><span class="p">,</span>
        <span class="n">extractor_conv_layer_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">extractor_conv_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder_embed_dim</span><span class="o">=</span><span class="mi">768</span><span class="p">,</span>
        <span class="n">encoder_projection_dropout</span><span class="o">=</span><span class="n">encoder_projection_dropout</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_kernel</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_groups</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_num_layers</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">encoder_num_heads</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">encoder_attention_dropout</span><span class="o">=</span><span class="n">encoder_attention_dropout</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_features</span><span class="o">=</span><span class="mi">3072</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_dropout</span><span class="o">=</span><span class="n">encoder_ff_interm_dropout</span><span class="p">,</span>
        <span class="n">encoder_dropout</span><span class="o">=</span><span class="n">encoder_dropout</span><span class="p">,</span>
        <span class="n">encoder_layer_norm_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder_layer_drop</span><span class="o">=</span><span class="n">encoder_layer_drop</span><span class="p">,</span>
        <span class="n">mask_prob</span><span class="o">=</span><span class="n">mask_prob</span><span class="p">,</span>
        <span class="n">mask_selection</span><span class="o">=</span><span class="s2">&quot;static&quot;</span><span class="p">,</span>
        <span class="n">mask_other</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">mask_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">no_mask_overlap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">mask_min_space</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">mask_channel_prob</span><span class="o">=</span><span class="n">mask_channel_prob</span><span class="p">,</span>
        <span class="n">mask_channel_selection</span><span class="o">=</span><span class="s2">&quot;static&quot;</span><span class="p">,</span>
        <span class="n">mask_channel_other</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">mask_channel_length</span><span class="o">=</span><span class="n">mask_channel_length</span><span class="p">,</span>
        <span class="n">no_mask_channel_overlap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">mask_channel_min_space</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">skip_masked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_nomask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span><span class="p">,</span>
        <span class="n">final_dim</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
        <span class="n">feature_grad_mult</span><span class="o">=</span><span class="n">feature_grad_mult</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="hubert_pretrain_large"><a class="viewcode-back" href="../../../../generated/torchaudio.models.hubert_pretrain_large.html#torchaudio.models.hubert_pretrain_large">[docs]</a><span class="k">def</span> <span class="nf">hubert_pretrain_large</span><span class="p">(</span>
    <span class="n">encoder_projection_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_attention_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_layer_drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">mask_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">mask_channel_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">mask_channel_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">feature_grad_mult</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HuBERTPretrainModel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Builds &quot;large&quot; :class:`HuBERTPretrainModel` from *HuBERT* :cite:`hsu2021hubert` for pretraining.</span>

<span class="sd">    Args:</span>
<span class="sd">        encoder_projection_dropout (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        encoder_attention_dropout (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        encoder_ff_interm_dropout (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        encoder_dropout (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        encoder_layer_drop (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        mask_prob (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        mask_channel_prob (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        mask_channel_length (int):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        feature_grad_mult (float or None):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        HuBERTPretrainModel:</span>
<span class="sd">            The resulting model.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="k">return</span> <span class="n">hubert_pretrain_model</span><span class="p">(</span>
        <span class="n">extractor_mode</span><span class="o">=</span><span class="s2">&quot;layer_norm&quot;</span><span class="p">,</span>
        <span class="n">extractor_conv_layer_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">extractor_conv_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder_embed_dim</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">encoder_projection_dropout</span><span class="o">=</span><span class="n">encoder_projection_dropout</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_kernel</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_groups</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_num_layers</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
        <span class="n">encoder_num_heads</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_attention_dropout</span><span class="o">=</span><span class="n">encoder_attention_dropout</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_features</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_dropout</span><span class="o">=</span><span class="n">encoder_ff_interm_dropout</span><span class="p">,</span>
        <span class="n">encoder_dropout</span><span class="o">=</span><span class="n">encoder_dropout</span><span class="p">,</span>
        <span class="n">encoder_layer_norm_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">encoder_layer_drop</span><span class="o">=</span><span class="n">encoder_layer_drop</span><span class="p">,</span>
        <span class="n">mask_prob</span><span class="o">=</span><span class="n">mask_prob</span><span class="p">,</span>
        <span class="n">mask_selection</span><span class="o">=</span><span class="s2">&quot;static&quot;</span><span class="p">,</span>
        <span class="n">mask_other</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">mask_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">no_mask_overlap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">mask_min_space</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">mask_channel_prob</span><span class="o">=</span><span class="n">mask_channel_prob</span><span class="p">,</span>
        <span class="n">mask_channel_selection</span><span class="o">=</span><span class="s2">&quot;static&quot;</span><span class="p">,</span>
        <span class="n">mask_channel_other</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">mask_channel_length</span><span class="o">=</span><span class="n">mask_channel_length</span><span class="p">,</span>
        <span class="n">no_mask_channel_overlap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">mask_channel_min_space</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">skip_masked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_nomask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">num_classes</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">final_dim</span><span class="o">=</span><span class="mi">768</span><span class="p">,</span>
        <span class="n">feature_grad_mult</span><span class="o">=</span><span class="n">feature_grad_mult</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="hubert_pretrain_xlarge"><a class="viewcode-back" href="../../../../generated/torchaudio.models.hubert_pretrain_xlarge.html#torchaudio.models.hubert_pretrain_xlarge">[docs]</a><span class="k">def</span> <span class="nf">hubert_pretrain_xlarge</span><span class="p">(</span>
    <span class="n">encoder_projection_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_attention_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_ff_interm_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">encoder_layer_drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">mask_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">mask_channel_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">mask_channel_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">feature_grad_mult</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HuBERTPretrainModel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Builds &quot;extra large&quot; :class:`HuBERTPretrainModel` from *HuBERT* :cite:`hsu2021hubert` for pretraining.</span>

<span class="sd">    Args:</span>
<span class="sd">        encoder_projection_dropout (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        encoder_attention_dropout (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        encoder_ff_interm_dropout (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        encoder_dropout (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        encoder_layer_drop (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        mask_prob (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        mask_channel_prob (float):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        mask_channel_length (int):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>
<span class="sd">        feature_grad_mult (float or None):</span>
<span class="sd">            See :py:func:`hubert_pretrain_model`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        HuBERTPretrainModel:</span>
<span class="sd">            The resulting model.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="k">return</span> <span class="n">hubert_pretrain_model</span><span class="p">(</span>
        <span class="n">extractor_mode</span><span class="o">=</span><span class="s2">&quot;layer_norm&quot;</span><span class="p">,</span>
        <span class="n">extractor_conv_layer_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">extractor_conv_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder_embed_dim</span><span class="o">=</span><span class="mi">1280</span><span class="p">,</span>
        <span class="n">encoder_projection_dropout</span><span class="o">=</span><span class="n">encoder_projection_dropout</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_kernel</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">encoder_pos_conv_groups</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_num_layers</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span>
        <span class="n">encoder_num_heads</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">encoder_attention_dropout</span><span class="o">=</span><span class="n">encoder_attention_dropout</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_features</span><span class="o">=</span><span class="mi">5120</span><span class="p">,</span>
        <span class="n">encoder_ff_interm_dropout</span><span class="o">=</span><span class="n">encoder_ff_interm_dropout</span><span class="p">,</span>
        <span class="n">encoder_dropout</span><span class="o">=</span><span class="n">encoder_dropout</span><span class="p">,</span>
        <span class="n">encoder_layer_norm_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">encoder_layer_drop</span><span class="o">=</span><span class="n">encoder_layer_drop</span><span class="p">,</span>
        <span class="n">mask_prob</span><span class="o">=</span><span class="n">mask_prob</span><span class="p">,</span>
        <span class="n">mask_selection</span><span class="o">=</span><span class="s2">&quot;static&quot;</span><span class="p">,</span>
        <span class="n">mask_other</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">mask_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">no_mask_overlap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">mask_min_space</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">mask_channel_prob</span><span class="o">=</span><span class="n">mask_channel_prob</span><span class="p">,</span>
        <span class="n">mask_channel_selection</span><span class="o">=</span><span class="s2">&quot;static&quot;</span><span class="p">,</span>
        <span class="n">mask_channel_other</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">mask_channel_length</span><span class="o">=</span><span class="n">mask_channel_length</span><span class="p">,</span>
        <span class="n">no_mask_channel_overlap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">mask_channel_min_space</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">skip_masked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_nomask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">num_classes</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">final_dim</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">feature_grad_mult</span><span class="o">=</span><span class="n">feature_grad_mult</span><span class="p">,</span>
    <span class="p">)</span></div>
</pre></div>

             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, Torchaudio Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>


        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
         <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
         <script src="../../../../_static/jquery.js"></script>
         <script src="../../../../_static/underscore.js"></script>
         <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
         <script src="../../../../_static/doctools.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js"></script>
         <script src="../../../../_static/katex_autorenderer.js"></script>
     

  

  <script type="text/javascript" src="../../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <script type="text/javascript">
    var collapsedSections = []
    </script>
     
    <script type="text/javascript">
      $(document).ready(function() {
	  var downloadNote = $(".sphx-glr-download-link-note.admonition.note");
	  if (downloadNote.length >= 1) {
	      var tutorialUrl = $("#tutorial-type").text();
	      var githubLink = "https://github.com/pytorch/audio/blob/main/examples/"  + tutorialUrl + ".py",
		  notebookLink = $(".reference.download")[1].href,
		  notebookDownloadPath = notebookLink.split('_downloads')[1],
		  colabLink = "https://colab.research.google.com/github/pytorch/audio/blob/gh-pages/main/_downloads" + notebookDownloadPath;

	      $(".pytorch-call-to-action-links a[data-response='Run in Google Colab']").attr("href", colabLink);
	      $(".pytorch-call-to-action-links a[data-response='View on Github']").attr("href", githubLink);
	  }

          var overwrite = function(_) {
              if ($(this).length > 0) {
                  $(this)[0].href = "https://github.com/pytorch/audio"
              }
          }
          // PC
          $(".main-menu a:contains('GitHub')").each(overwrite);
          // Mobile
          $(".main-menu a:contains('Github')").each(overwrite);
      });

      
    </script>


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">Stay up to date</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">Facebook</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">Twitter</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">LinkedIn</a></li>
          </ul>  
          </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch Podcasts</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">Apple</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">Google</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">Amazon</a></li>
          </ul>
         </div>
        </div>
        
        <div class="privacy-policy">
          <ul>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">Terms</a></li>
            <li class="privacy-policy-links">|</li>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">Privacy</a></li>
          </ul>
        </div>
        <div class="copyright">
        <p>Â© Copyright The Linux Foundation. The PyTorch Foundation is a project of The Linux Foundation.
          For web site terms of use, trademark policy and other policies applicable to The PyTorch Foundation please see
          <a href="www.linuxfoundation.org/policies/">www.linuxfoundation.org/policies/</a>. The PyTorch Foundation supports the PyTorch open source
          project, which has been established as PyTorch Project a Series of LF Projects, LLC. For policies applicable to the PyTorch Project a Series of LF Projects, LLC,
          please see <a href="www.lfprojects.org/policies/">www.lfprojects.org/policies/</a>.</p>
      </div>
     </div>

  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebookâ€™s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../../../../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/torchx/">TorchX</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>