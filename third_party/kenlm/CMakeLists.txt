include (ExternalProject)

set(INSTALL_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../install)
set(ARCHIVE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/archives)

set(KENLM_MAX_ORDER 6 CACHE STRING "Maximum ngram order for KenLM")

ExternalProject_Add(kenlm_
  PREFIX kenlm
  DOWNLOAD_DIR ${ARCHIVE_DIR}
  GIT_REPOSITORY https://github.com/kpu/kenlm.git
  GIT_TAG 4a277534fd33da323205e6ec256e8fd0ff6ee6fa
  BUILD_IN_SOURCE 1
  BUILD_COMMAND ${CMAKE_COMMAND} --build .
  CMAKE_CACHE_ARGS
    -DBUILD_SHARED_LIBS:BOOL=${BUILD_SHARED_LIBS}
    -DCMAKE_BUILD_TYPE:STRING=${CMAKE_BUILD_TYPE}
    -DCMAKE_INSTALL_PREFIX:PATH=${INSTALL_DIR}
  BUILD_BYPRODUCTS ${KENLM_LIBRARIES}
  DOWNLOAD_NO_PROGRESS ON
  LOG_DOWNLOAD ON
  LOG_UPDATE ON
  LOG_CONFIGURE ON
  LOG_BUILD ON
  LOG_INSTALL ON
  LOG_MERGED_STDOUTERR ON
  LOG_OUTPUT_ON_FAILURE ON
  )
add_dependencies(kenlm kenlm_)
set(KENLM_INCLUDE_DIRS ${KENLM_INCLUDE_DIRS} PARENT_SCOPE)
set(KENLM_LIBRARIES ${KENLM_LIBRARIES} PARENT_SCOPE)